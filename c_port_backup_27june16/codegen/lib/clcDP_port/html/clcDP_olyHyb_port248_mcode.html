<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="81,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [          <span class="keyword">...</span><span class="comment">  --- AusgangsgrÃ¶ÃŸen:</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,2" id="srcline2">  2</a></span><span class="line">    <span class="var type1" id="S2T59U3">optPreInxTn3</span>,   <span class="keyword">...</span><span class="comment"> Tensor 3. Stufe fÃ¼r opt. VorgÃ¤ngerkoordinaten</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,3" id="srcline3">  3</a></span><span class="line">    <span class="var type1" id="S3T59U4">batFrcOptTn3</span>,   <span class="keyword">...</span><span class="comment"> Tensor 3. Stufe der Batteriekraft</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,4" id="srcline4">  4</a></span><span class="line">    <span class="var type1" id="S4T59U5">fulEngOptTn3</span>,   <span class="keyword">...</span><span class="comment"> Tensor 3. Stufe fÃ¼r die Kraftstoffenergie </span></span></span>
<span class="srcline"><span class="lineno"><a href="81,5" id="srcline5">  5</a></span><span class="line">    <span class="var type1" id="S5T45U6">cos2goActMat</span>    <span class="keyword">...</span><span class="comment"> Matrix der optimalen Kosten der Hamiltonfunktion </span></span></span>
<span class="srcline"><span class="lineno"><a href="81,6" id="srcline6">  6</a></span><span class="line">    ] =             <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,7" id="srcline7">  7</a></span><span class="line">    clcDP_olyHyb_port<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,8" id="srcline8">  8</a></span><span class="line">    (               <span class="keyword">...</span><span class="comment"> --- EingangsgrÃ¶ÃŸen:</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,9" id="srcline9">  9</a></span><span class="line">    <span class="var type1" id="S6T2U9">disFlg</span>,         <span class="keyword">...</span><span class="comment"> Skalar - Flag fÃ¼r Ausgabe in das Commandwindow</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,10" id="srcline10"> 10</a></span><span class="line">    <span class="var type1" id="S7T2U10">wayStp</span>,         <span class="keyword">...</span><span class="comment"> Skalar für die Wegschrittweite in m</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,11" id="srcline11"> 11</a></span><span class="line">    <span class="var type1" id="S8T2U11">batEngStp</span>,      <span class="keyword">...</span><span class="comment"> Skalar der Batteriediskretisierung in J</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,12" id="srcline12"> 12</a></span><span class="line">    <span class="var type1" id="S9T2U12">batEngBeg</span>,      <span class="keyword">...</span><span class="comment"> Skalar für die Batterieenergie am Beginn in Ws</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,13" id="srcline13"> 13</a></span><span class="line">    <span class="var type1" id="S10T2U13">batPwrAux</span>,      <span class="keyword">...</span><span class="comment"> Skalar für die Nebenverbrauchlast in W</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,14" id="srcline14"> 14</a></span><span class="line">    <span class="var type1" id="S11T2U14">psiBatEng</span>,      <span class="keyword">...</span><span class="comment"> Skalar für den Co-State der Batterieenergie</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,15" id="srcline15"> 15</a></span><span class="line">    <span class="var type1" id="S12T2U15">psiTim</span>,         <span class="keyword">...</span><span class="comment"> Skalar für den Co-State der Zeit</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,16" id="srcline16"> 16</a></span><span class="line">    <span class="var type1" id="S13T2U16">staChgPenCosVal</span>,<span class="keyword">...</span><span class="comment"> Skalar für die Strafkosten beim Zustandswechsel</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,17" id="srcline17"> 17</a></span><span class="line">    <span class="var type1" id="S14T2U17">wayInxBeg</span>,      <span class="keyword">...</span><span class="comment"> Skalar für Anfangsindex in den Eingangsdaten</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,18" id="srcline18"> 18</a></span><span class="line">    <span class="var type1" id="S15T2U18">wayInxEnd</span>,      <span class="keyword">...</span><span class="comment"> Skalar für Endindex in den Eingangsdaten</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,19" id="srcline19"> 19</a></span><span class="line">    <span class="var type1" id="S16T2U19">engKinBegInx</span>,   <span class="keyword">...</span><span class="comment"> Skalar für den Index der Anfangsgeschwindigkeit</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,20" id="srcline20"> 20</a></span><span class="line">    <span class="var type1" id="S17T2U20">engKinNum</span>,      <span class="keyword">...</span><span class="comment"> Skalar für die max. Anz. an engKin-StÃ¼tzstellen</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,21" id="srcline21"> 21</a></span><span class="line">    <span class="var type1" id="S18T2U21">staNum</span>,         <span class="keyword">...</span><span class="comment"> Skalar für die max. Anzahl an ZustandsstÃ¼tzstellen</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,22" id="srcline22"> 22</a></span><span class="line">    <span class="var type1" id="S19T2U22">wayNum</span>,         <span class="keyword">...</span><span class="comment"> Skalar für die Stufe der Batteriekraftmax. Anzahl an Wegstützstellen</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,23" id="srcline23"> 23</a></span><span class="line">    <span class="var type1" id="S20T2U23">staBeg</span>,         <span class="keyword">...</span><span class="comment"> Skalar für den Startzustand des Antriebsstrangs</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,24" id="srcline24"> 24</a></span><span class="line">    <span class="var type1" id="S21T5U24">engKinNumVec_wayInx</span>,       <span class="keyword">...</span><span class="comment"> Vektor der Anzahl der kinetischen Energien</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,25" id="srcline25"> 25</a></span><span class="line">    <span class="var type1" id="S22T5U25">slpVec_wayInx</span>,  <span class="keyword">...</span><span class="comment"> Vektor der Steigungen in rad</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,26" id="srcline26"> 26</a></span><span class="line">    <span class="var type1" id="S23T6U26">engKinMat_engKinInx_wayInx</span>,<span class="keyword">...</span><span class="comment"> Matrix der kinetischen Energien in J</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,27" id="srcline27"> 27</a></span><span class="line">    <span class="var type1" id="S24T34U27">fzg_scalar</span>,     <span class="keyword">...</span><span class="comment"> struct der Fahrzeugparameter - NUR SKALARS</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,28" id="srcline28"> 28</a></span><span class="line">    <span class="var type1" id="S25T35U28">fzg_array</span>       <span class="keyword">...</span><span class="comment"> struct der Fahrzeugparameter - NUR ARRAYS</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,29" id="srcline29"> 29</a></span><span class="line">    )<span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%INIDP Calculating optimal predecessors with DP + PMP</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">% Erstellungsdatum der ersten Version 20.08.2015 - Stephan Uebel</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">% Diese Funktion berechnet die optimalen VorgÃ¤nger der Dynamischen</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">% Programmierung (DP). Diese subsitutiert die ZustÃ¤nde Zeit und</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">% Batterieenergie durch Co-States. Die Kosten werden mit dem</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">% Pontryaginschen Minimumsprinzip berechnet.</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">%   This function calculates the optimum predecessor from dynamic</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">%   programming (DP). Each state's time and battery power costates are</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">%   substituted from a Potryagin's Minimum Principle calculation.</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">% Variante olyHyb erlaubt nur hybridisches Fahren (Motor ist immer an)</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">%   variation olyHyb permits only hybrid driving (motor is always on)</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,44" id="srcline44"> 44</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">% Ã„nderung am 23.02.2016 - optimale Kosten nicht direkt aus Index von min()</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">% bestimmt. Das fÃ¤hrt zu einem anderen Schaltverhalten, da GÃ¤nge teilweise</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">% gleiche Kosten verursachen. In dem Fall wird jetzt der niedrigste Gang</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">% gewÃ¤hlt, wie in der DP.</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">%   change on 23.02.2016 - optimal costs are not directly from the min()</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">%   index. The move to another switching behaviour is because the</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">%   transitions FZGtially caused the same costs. The lowester gear is now</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">%   selected in DP</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">% !!!! Generelle Festlegung, wie Vektoren/Tensoren zu lesen sind !!!!</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">% Werte, die am Anfang und am Ende eines Intervalls gelten, stehen an der</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">% jeweiligen Position des Vektors.</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,57" id="srcline57"> 57</a></span><span class="line"><span class="comment">%   !!!! Please note, how vectors/tensors are read (??) !!!!</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">%   Values that are at the beginning and end of an interval are at their</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">%   respective indexes along the vector.</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">% Mittelwerte, d.h. FlussgrÃ¶ÃŸen wie KrÃ¤fte, Leistungen etc., stehen immmer</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">% am Anfang des Intervalls fÃ¼r das folgende Intervall. Diese</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">% Vektoren/Tensoren sind daher um einen gÃ¼ltigen Eintrag kÃ¼rzer.</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">%   mean values (eg flow variables like forces, services) are always at the</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,65" id="srcline65"> 65</a></span><span class="line"><span class="comment">%   beginning of the interval for the next interval. Those vectors/tensors</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">%   are therefore shorter by a valid entry (index?).</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,67" id="srcline67"> 67</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="81,68" id="srcline68"> 68</a></span><span class="line"><span class="comment">%% Initialisieren der persistent GrÃ¶ÃŸen</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">% Diese werden die nur einmal fÃ¼r die Funktion berechnet</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">%   assigning input structure values to function persistant variables</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%   - just once</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,72" id="srcline72"> 72</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type1" id="S26T2U30">geaNum</span> <span class="var type1" id="S27T2U31">vehMas</span> <span class="var type1" id="S28T2U32">vehAccMin</span> <span class="var type1" id="S29T2U33">vehAccMax</span> <span class="var type1" id="S30T8U34">iceFlg</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,73" id="srcline73"> 73</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="81,74" id="srcline74"> 74</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T8:U30"><span class="mxinfo " id="T8:U31">isempty(<span class="var type0" id="S26T0U39">geaNum</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="81,75" id="srcline75"> 75</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="81,76" id="srcline76"> 76</a></span><span class="line"><span class="comment">%     geaNum    = zeros(1,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,77" id="srcline77"> 77</a></span><span class="line"><span class="comment">%     vehMas    = zeros(1,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,78" id="srcline78"> 78</a></span><span class="line"><span class="comment">%     vehAccMin = zeros(1,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,79" id="srcline79"> 79</a></span><span class="line"><span class="comment">%     vehAccMax = zeros(1,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,80" id="srcline80"> 80</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="81,81" id="srcline81"> 81</a></span><span class="line">    <span class="comment">% Anzahl der GÃ¤nge</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,82" id="srcline82"> 82</a></span><span class="line">    <span class="comment">%   number of gears</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,83" id="srcline83"> 83</a></span><span class="line">    <span class="mxinfo " id="T2:U32"><span class="var type1" id="S26T2U42">geaNum</span> = <span class="var type1" id="S18T2U43">staNum</span></span>; <span class="comment">% max number of state nodes</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,84" id="srcline84"> 84</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="81,85" id="srcline85"> 85</a></span><span class="line">    <span class="comment">% Fahrzeugmasse;</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,86" id="srcline86"> 86</a></span><span class="line">    <span class="mxinfo " id="T2:U35"><span class="var type1" id="S27T2U46">vehMas</span> = <span class="mxinfo " id="T2:U37"><span class="var type1" id="S24T34U48">fzg_scalar</span>.vehMas</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,87" id="srcline87"> 87</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="81,88" id="srcline88"> 88</a></span><span class="line">    <span class="comment">% minmiale und maximale Beschleunigung</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,89" id="srcline89"> 89</a></span><span class="line">    <span class="comment">%   min and max accerlations (bounds)</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,90" id="srcline90"> 90</a></span><span class="line">    <span class="mxinfo " id="T2:U39"><span class="var type1" id="S28T2U52">vehAccMin</span> = <span class="mxinfo " id="T2:U41"><span class="var type1" id="S24T34U54">fzg_scalar</span>.vehAccMin</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,91" id="srcline91"> 91</a></span><span class="line">    <span class="mxinfo " id="T2:U43"><span class="var type1" id="S29T2U58">vehAccMax</span> = <span class="mxinfo " id="T2:U45"><span class="var type1" id="S24T34U60">fzg_scalar</span>.vehAccMax</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,92" id="srcline92"> 92</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="81,93" id="srcline93"> 93</a></span><span class="line">    <span class="comment">% In dieser Version ist der Motor immer an</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,94" id="srcline94"> 94</a></span><span class="line">    <span class="mxinfo " id="T8:U47"><span class="var type1" id="S30T8U64">iceFlg</span> = <span class="mxinfo " id="T8:U49">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,95" id="srcline95"> 95</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="81,96" id="srcline96"> 96</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,97" id="srcline97"> 97</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="81,98" id="srcline98"> 98</a></span><span class="line"><span class="comment">%% Initialisieren der Ausgabe der Funktion</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,99" id="srcline99"> 99</a></span><span class="line"><span class="comment">%   initialzing function output</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,100" id="srcline100">100</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="81,101" id="srcline101">101</a></span><span class="line"><span class="comment">% Tensor 3. Stufe fÃ¼r optimalen VorgÃ¤ngerkoordinaten</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,102" id="srcline102">102</a></span><span class="line"><span class="comment">%   tensor3 for optimal previous coordinates/idx</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,103" id="srcline103">103</a></span><span class="line"><span class="mxinfo " id="T59:U50"><span class="var type1" id="S2T59U69">optPreInxTn3</span> = <span class="mxinfo " id="T59:U52">zeros(<span class="var type1" id="S17T2U72">engKinNum</span>,<span class="var type1" id="S18T2U73">staNum</span>,<span class="var type1" id="S19T2U74">wayNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,104" id="srcline104">104</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="81,105" id="srcline105">105</a></span><span class="line"><span class="comment">% Tensor 3. Stufe fÃ¼r die Kraftstoffenergie</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,106" id="srcline106">106</a></span><span class="line"><span class="comment">%   tensor3 for fuel energy</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,107" id="srcline107">107</a></span><span class="line"><span class="mxinfo " id="T59:U56"><span class="var type1" id="S4T59U77">fulEngOptTn3</span> = <span class="mxinfo " id="T59:U58">inf(<span class="var type1" id="S17T2U80">engKinNum</span>,<span class="var type1" id="S18T2U81">staNum</span>,<span class="var type1" id="S19T2U82">wayNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,108" id="srcline108">108</a></span><span class="line"><span class="comment">%   set initial fuel energy level to 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,109" id="srcline109">109</a></span><span class="line"><span class="mxinfo " id="T2:U62"><span class="mxinfo " id="T2:U63"><span class="var type1" id="S4T59U86">fulEngOptTn3</span>(<span class="var type1" id="S16T2U87">engKinBegInx</span>,<span class="var type1" id="S20T2U88">staBeg</span>,<span class="var type1" id="S14T2U89">wayInxBeg</span>)</span> = <span class="mxinfo " id="T2:U68">0</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="81,110" id="srcline110">110</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="81,111" id="srcline111">111</a></span><span class="line"><span class="comment">% Tensor 3. Stufe fÃ¼r die Batterienergie</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,112" id="srcline112">112</a></span><span class="line"><span class="comment">%   tensor3 for battery energy</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,113" id="srcline113">113</a></span><span class="line"><span class="mxinfo " id="T59:U69"><span class="var type1" id="S3T59U93">batFrcOptTn3</span> = <span class="mxinfo " id="T59:U71">inf(<span class="var type1" id="S17T2U96">engKinNum</span>,<span class="var type1" id="S18T2U97">staNum</span>,<span class="var type1" id="S19T2U98">wayNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,114" id="srcline114">114</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="81,115" id="srcline115">115</a></span><span class="line"><span class="comment">%% Berechnung der optimalen VorgÃ¤nger</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,116" id="srcline116">116</a></span><span class="line"><span class="comment">%   calculating the optimal predecessors</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,117" id="srcline117">117</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="81,118" id="srcline118">118</a></span><span class="line"><span class="comment">% Initialisieren der Matrix fÃ¼r die Kosten bis zu den Punkten im letzten</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,119" id="srcline119">119</a></span><span class="line"><span class="comment">% Wegschritt</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,120" id="srcline120">120</a></span><span class="line"><span class="comment">%   initialize the matrix for the cost to the points in the last wayidx</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,121" id="srcline121">121</a></span><span class="line"><span class="mxinfo " id="T45:U75"><span class="var type1" id="S35T45U101">cos2goPreMat</span> = <span class="mxinfo " id="T45:U77">inf(<span class="var type1" id="S17T2U104">engKinNum</span>,<span class="var type1" id="S18T2U105">staNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,122" id="srcline122">122</a></span><span class="line"><span class="mxinfo " id="T45:U80"><span class="var type1" id="S5T45U108">cos2goActMat</span> = <span class="mxinfo " id="T45:U82">inf(<span class="var type1" id="S17T2U111">engKinNum</span>,<span class="var type1" id="S18T2U112">staNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,123" id="srcline123">123</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="81,124" id="srcline124">124</a></span><span class="line"><span class="comment">% Erste Initilisierung beim Startindex mit 0 fÃ¼r alle ZustÃ¤nde(concluded)</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,125" id="srcline125">125</a></span><span class="line"><span class="comment">%   first, initialize the startidx to 0 for all states</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,126" id="srcline126">126</a></span><span class="line"><span class="mxinfo " id="T2:U85"><span class="mxinfo " id="T2:U86"><span class="var type1" id="S35T45U116">cos2goPreMat</span>(<span class="var type1" id="S16T2U117">engKinBegInx</span>,<span class="var type1" id="S20T2U118">staBeg</span>)</span> = <span class="mxinfo " id="T2:U90">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,127" id="srcline127">127</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="81,128" id="srcline128">128</a></span><span class="line"><span class="comment">% Initialisierung der Matrix der Batterieenergien</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,129" id="srcline129">129</a></span><span class="line"><span class="comment">%   initialize the battery energy matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,130" id="srcline130">130</a></span><span class="line"><span class="mxinfo " id="T45:U91"><span class="var type1" id="S36T45U122">batEngPreMat</span> = <span class="mxinfo " id="T45:U93">inf(<span class="var type1" id="S17T2U125">engKinNum</span>,<span class="var type1" id="S18T2U126">staNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,131" id="srcline131">131</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="81,132" id="srcline132">132</a></span><span class="line"><span class="comment">% Erste Initilisierung beim Startindex mit Startladung fÃ¼r den Startzustand</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,133" id="srcline133">133</a></span><span class="line"><span class="comment">%   first, intialize start index of the starting charge for intial state</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,134" id="srcline134">134</a></span><span class="line"><span class="mxinfo " id="T2:U96"><span class="mxinfo " id="T2:U97"><span class="var type1" id="S36T45U130">batEngPreMat</span>(<span class="var type1" id="S16T2U131">engKinBegInx</span>,<span class="var type1" id="S20T2U132">staBeg</span>)</span> = <span class="var type1" id="S9T2U133">batEngBeg</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,135" id="srcline135">135</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="81,136" id="srcline136">136</a></span><span class="line"><span class="comment">% Initialisierung der Matrix der Kraftstoffenergien</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,137" id="srcline137">137</a></span><span class="line"><span class="comment">%   initialze the fuel energy matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,138" id="srcline138">138</a></span><span class="line"><span class="mxinfo " id="T45:U102"><span class="var type1" id="S37T45U136">fulEngPreMat</span> = <span class="mxinfo " id="T45:U104">inf(<span class="var type1" id="S17T2U139">engKinNum</span>,<span class="var type1" id="S18T2U140">staNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,139" id="srcline139">139</a></span><span class="line"><span class="comment">% Erste Initilisierung beim Startindex mit 0 fÃ¼r den Startzustand</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,140" id="srcline140">140</a></span><span class="line"><span class="comment">%   first, intialize the start idx for the intitial states to 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,141" id="srcline141">141</a></span><span class="line"><span class="mxinfo " id="T2:U107"><span class="mxinfo " id="T2:U108"><span class="var type1" id="S37T45U144">fulEngPreMat</span>(<span class="var type1" id="S16T2U145">engKinBegInx</span>,<span class="var type1" id="S20T2U146">staBeg</span>)</span> = <span class="mxinfo " id="T2:U112">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,142" id="srcline142">142</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="81,143" id="srcline143">143</a></span><span class="line"><span class="comment">% Schleife Ã¼ber alle Wegpunkte</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,144" id="srcline144">144</a></span><span class="line"><span class="comment">%   looping thorugh length of # of grid discretization/indeces (Weginputs)</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,145" id="srcline145">145</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S38T2U150">wayInx</span> = <span class="mxinfo " id="T2:U114"><span class="var type1" id="S14T2U153">wayInxBeg</span>+<span class="mxinfo " id="T2:U116">1</span></span>:<span class="var type1" id="S15T2U155">wayInxEnd</span>      <span class="comment">% PATH IDX LOOP</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,146" id="srcline146">146</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="81,147" id="srcline147">147</a></span><span class="line">    <span class="comment">% mittlere Steigung im betrachteten Intervall </span></span></span>
<span class="srcline"><span class="lineno"><a href="81,148" id="srcline148">148</a></span><span class="line">    <span class="comment">%   no longer doing mean, using previous gradiant instead</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,149" id="srcline149">149</a></span><span class="line">    <span class="mxinfo " id="T2:U118"><span class="var type1" id="S39T2U158">slp</span> = <span class="mxinfo " id="T2:U120"><span class="var type1" id="S22T5U160">slpVec_wayInx</span>(<span class="mxinfo " id="T2:U122"><span class="var type1" id="S38T2U162">wayInx</span>-<span class="mxinfo " id="T2:U124">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,150" id="srcline150">150</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="81,151" id="srcline151">151</a></span><span class="line">    <span class="comment">%% Berechnung der kinetischen Energien im aktuellen Wegschritt</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,152" id="srcline152">152</a></span><span class="line">    <span class="comment">% Vorbereitung der FZGallen Schleife (verhindern von zu grossem</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,153" id="srcline153">153</a></span><span class="line">    <span class="comment">% Datentransfer und unnÃ¶tigen Berechnungen)</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,154" id="srcline154">154</a></span><span class="line">    <span class="comment">%   Calculating the KE for current index/waypoint.</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,155" id="srcline155">155</a></span><span class="line">    <span class="comment">%   Preperation of FZGallel loop (prevent a too large data transfer,</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,156" id="srcline156">156</a></span><span class="line">    <span class="comment">%   unnecessary computations).   </span></span></span>
<span class="srcline"><span class="lineno"><a href="81,157" id="srcline157">157</a></span><span class="line">   </span></span>
<span class="srcline"><span class="lineno"><a href="81,158" id="srcline158">158</a></span><span class="line">    <span class="comment">% Initialisieren der Matrix fÃ¼r die optimalen Batteriekrafter im</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,159" id="srcline159">159</a></span><span class="line">    <span class="comment">% Intervall</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,160" id="srcline160">160</a></span><span class="line">    <span class="comment">%   initialize matrix for optimale battery force intervals (discreti.)</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,161" id="srcline161">161</a></span><span class="line">    <span class="mxinfo " id="T45:U125"><span class="var type1" id="S40T45U166">batFrcOptMat</span> = <span class="mxinfo " id="T45:U127">inf(<span class="var type1" id="S17T2U169">engKinNum</span>,<span class="var type1" id="S18T2U170">staNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,162" id="srcline162">162</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="81,163" id="srcline163">163</a></span><span class="line">    <span class="comment">% Initialisieren der Matrix fÃ¼r die Kosten bis zu den Punkten im</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,164" id="srcline164">164</a></span><span class="line">    <span class="comment">% aktuellen Wegschritt</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,165" id="srcline165">165</a></span><span class="line">    <span class="comment">%   initialize cost matrix to points in current path steps (idxs?)</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,166" id="srcline166">166</a></span><span class="line">    <span class="mxinfo " id="T45:U130"><span class="var type1" id="S5T45U173">cos2goActMat</span> = <span class="mxinfo " id="T45:U132">inf(<span class="var type1" id="S17T2U176">engKinNum</span>,<span class="var type1" id="S18T2U177">staNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,167" id="srcline167">167</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="81,168" id="srcline168">168</a></span><span class="line">    <span class="comment">% Initialisieren der Matrix fÃ¼r die Batterieenergie an den Punkten im</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,169" id="srcline169">169</a></span><span class="line">    <span class="comment">% aktuellen Wegschritt</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,170" id="srcline170">170</a></span><span class="line">    <span class="comment">%   initialize matrix for battery energy at points along current wayidx</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,171" id="srcline171">171</a></span><span class="line">    <span class="mxinfo " id="T45:U135"><span class="var type1" id="S41T45U180">batEngActMat</span> = <span class="mxinfo " id="T45:U137">inf(<span class="var type1" id="S17T2U183">engKinNum</span>,<span class="var type1" id="S18T2U184">staNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,172" id="srcline172">172</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="81,173" id="srcline173">173</a></span><span class="line">    <span class="comment">% Initialisieren der Matrix fÃ¼r die Krafstoffenergie an den Punkten im</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,174" id="srcline174">174</a></span><span class="line">    <span class="comment">% aktuellen Wegschritt</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,175" id="srcline175">175</a></span><span class="line">    <span class="comment">%   initialize matrix for fuel energie along current way idxs</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,176" id="srcline176">176</a></span><span class="line">    <span class="mxinfo " id="T45:U140"><span class="var type1" id="S42T45U187">fulEngActMat</span> = <span class="mxinfo " id="T45:U142">inf(<span class="var type1" id="S17T2U190">engKinNum</span>,<span class="var type1" id="S18T2U191">staNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,177" id="srcline177">177</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="81,178" id="srcline178">178</a></span><span class="line">    <span class="comment">% Anzahl der kinetischen Energien im aktuellen und im</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,179" id="srcline179">179</a></span><span class="line">    <span class="comment">% VorgÃ¤ngerwegschritt</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,180" id="srcline180">180</a></span><span class="line">    <span class="comment">%   number of kinetic energies in current and past path_idxs</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,181" id="srcline181">181</a></span><span class="line">    <span class="mxinfo " id="T2:U145"><span class="var type1" id="S43T2U194">engKinNumAct</span> = <span class="mxinfo " id="T2:U147"><span class="var type1" id="S21T5U196">engKinNumVec_wayInx</span>(<span class="var type1" id="S38T2U197">wayInx</span>)</span></span>; <span class="comment">% look at this loop's KE</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,182" id="srcline182">182</a></span><span class="line">    <span class="mxinfo " id="T2:U150"><span class="var type1" id="S44T2U200">engKinNumPre</span> = <span class="mxinfo " id="T2:U152"><span class="var type1" id="S21T5U202">engKinNumVec_wayInx</span>(<span class="mxinfo " id="T2:U154"><span class="var type1" id="S38T2U204">wayInx</span>-<span class="mxinfo " id="T2:U156">1</span></span>)</span></span>; <span class="comment">% and the previous idx KE</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,183" id="srcline183">183</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="81,184" id="srcline184">184</a></span><span class="line">    <span class="comment">% Vektoren der kinetischen Energien im vorherigen Wegschritt</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,185" id="srcline185">185</a></span><span class="line">    <span class="comment">%   vector of the KE in the previous idx</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,186" id="srcline186">186</a></span><span class="line">    <span class="mxinfo " id="T41:U157"><span class="var type1" id="S45T41U208">engKinPreVec_engKinInx</span> = <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="81,187" id="srcline187">187</a></span><span class="line"><span class="mxinfo " id="T41:U157">        <span class="mxinfo " id="T41:U159"><span class="var type1" id="S23T6U210">engKinMat_engKinInx_wayInx</span>(<span class="mxinfo " id="T70:U161">:</span>,<span class="mxinfo " id="T2:U162"><span class="var type1" id="S38T2U213">wayInx</span>-<span class="mxinfo " id="T2:U164">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,188" id="srcline188">188</a></span><span class="line">    <span class="comment">% Vektoren der kinetischen Energien im aktuellen Wegschritt</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,189" id="srcline189">189</a></span><span class="line">    <span class="comment">%   KE vector of the current path_idx</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,190" id="srcline190">190</a></span><span class="line">    <span class="mxinfo " id="T41:U165"><span class="var type1" id="S46T41U217">engKinActVec_engKinInx</span> = <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="81,191" id="srcline191">191</a></span><span class="line"><span class="mxinfo " id="T41:U165">        <span class="mxinfo " id="T41:U167"><span class="var type1" id="S23T6U219">engKinMat_engKinInx_wayInx</span>(<span class="mxinfo " id="T70:U169">:</span>,<span class="var type1" id="S38T2U221">wayInx</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,192" id="srcline192">192</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="81,193" id="srcline193">193</a></span><span class="line">    <span class="comment">% (FZGfor) Schleife Ã¼ber alle akutellen kinetischen Energien</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,194" id="srcline194">194</a></span><span class="line">    <span class="comment">%   loop through all the current kinetic energies</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,195" id="srcline195">195</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S47T2U224">engKinActInx</span> = <span class="mxinfo " id="T2:U172">1</span>:<span class="var type1" id="S43T2U227">engKinNumAct</span>   <span class="comment">% CURRENT KINETIC ENERGY LOOP</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,196" id="srcline196">196</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="81,197" id="srcline197">197</a></span><span class="line">        <span class="comment">% akutelle kinetsiche Energie bestimmen</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,198" id="srcline198">198</a></span><span class="line">        <span class="comment">%   determine the current kinetic energy</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,199" id="srcline199">199</a></span><span class="line">        <span class="mxinfo " id="T2:U174"><span class="var type1" id="S48T2U230">engKinAct</span> = <span class="mxinfo " id="T2:U176"><span class="var type1" id="S46T41U232">engKinActVec_engKinInx</span>(<span class="var type1" id="S47T2U233">engKinActInx</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,200" id="srcline200">200</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="81,201" id="srcline201">201</a></span><span class="line">        <span class="comment">% Schleife Ã¼ber alle mÃ¶glichen aktuellen ZustÃ¤nde des Antriesstrangs</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,202" id="srcline202">202</a></span><span class="line">        <span class="comment">%   Loop over all possible current powertrain states/all the gears</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,203" id="srcline203">203</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S49T2U236">staAct</span> = <span class="mxinfo " id="T2:U180">1</span>:<span class="var type1" id="S18T2U239">staNum</span>           <span class="comment">% ALL GEARS LOOP</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,204" id="srcline204">204</a></span><span class="line">            <span class="comment">%% Initialsiieren</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,205" id="srcline205">205</a></span><span class="line">            <span class="comment">%   note-you are preallocating over each powertrain state loop</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,206" id="srcline206">206</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="81,207" id="srcline207">207</a></span><span class="line">            <span class="comment">% Initialisieren der AusgabegrÃ¶ÃŸe der Schleife</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,208" id="srcline208">208</a></span><span class="line">            <span class="comment">%   preallocate the loop's output size</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,209" id="srcline209">209</a></span><span class="line">            <span class="comment">%   but this is the hamiltonian cost?</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,210" id="srcline210">210</a></span><span class="line">            <span class="mxinfo " id="T2:U182"><span class="var type1" id="S50T2U242">cosHamMin</span> = <span class="mxinfo " id="T2:U184">inf</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,211" id="srcline211">211</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="81,212" id="srcline212">212</a></span><span class="line">            <span class="comment">% Initialisieren der Variable fÃ¼r den optimalen Zustandsindex</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,213" id="srcline213">213</a></span><span class="line">            <span class="comment">%   initializing variable for optimal state index</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,214" id="srcline214">214</a></span><span class="line">            <span class="mxinfo " id="T2:U185"><span class="var type1" id="S51T2U247">staPreOptInx</span> = <span class="mxinfo " id="T2:U187">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,215" id="srcline215">215</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="81,216" id="srcline216">216</a></span><span class="line">            <span class="comment">% Initialisieren der Variable fÃ¼r die Koordinaten des optimalen</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,217" id="srcline217">217</a></span><span class="line">            <span class="comment">% VorgÃ¤ngers</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,218" id="srcline218">218</a></span><span class="line">            <span class="comment">%   initializing variable for optimal coords/KE for prev. idx</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,219" id="srcline219">219</a></span><span class="line">            <span class="mxinfo " id="T2:U188"><span class="var type1" id="S52T2U251">engKinPreOptInx</span> = <span class="mxinfo " id="T2:U190">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,220" id="srcline220">220</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="81,221" id="srcline221">221</a></span><span class="line">            <span class="comment">% Initialisieren der optimalen KraftstoffenergieÃ¤nderung zum</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,222" id="srcline222">222</a></span><span class="line">            <span class="comment">% betrachteten Punkt</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,223" id="srcline223">223</a></span><span class="line">            <span class="comment">%   preallocate the optimum fuel energy change to the point</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,224" id="srcline224">224</a></span><span class="line">            <span class="comment">%   considered</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,225" id="srcline225">225</a></span><span class="line">            <span class="mxinfo " id="T2:U191"><span class="var type1" id="S53T2U255">fulEngOpt</span> = <span class="mxinfo " id="T2:U193">inf</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,226" id="srcline226">226</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="81,227" id="srcline227">227</a></span><span class="line">            <span class="comment">% Initialisieren der optimalen Batteriekraft zum</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,228" id="srcline228">228</a></span><span class="line">            <span class="comment">% betrachteten Punkt</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,229" id="srcline229">229</a></span><span class="line">            <span class="comment">%   preallocate the optimal battery force to the point under</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,230" id="srcline230">230</a></span><span class="line">            <span class="comment">%   consideration</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,231" id="srcline231">231</a></span><span class="line">            <span class="mxinfo " id="T2:U194"><span class="var type1" id="S54T2U260">batFrcOpt</span> = <span class="mxinfo " id="T2:U196">inf</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,232" id="srcline232">232</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="81,233" id="srcline233">233</a></span><span class="line">            <span class="comment">% Initialisieren der optimalen Batterieenergie zum</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,234" id="srcline234">234</a></span><span class="line">            <span class="comment">% betrachteten Punkt</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,235" id="srcline235">235</a></span><span class="line">            <span class="comment">%   initialize the optimal battery power (up to boundry limits)</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,236" id="srcline236">236</a></span><span class="line">            <span class="mxinfo " id="T2:U197"><span class="var type1" id="S55T2U265">batEngOpt</span> = <span class="mxinfo " id="T2:U199">inf</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,237" id="srcline237">237</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="81,238" id="srcline238">238</a></span><span class="line">            <span class="comment">%% VorgÃ¤ngerzustÃ¤nde beschrÃ¤nken</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,239" id="srcline239">239</a></span><span class="line">            <span class="comment">%   Restrictions on predecessor operation states</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,240" id="srcline240">240</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="81,241" id="srcline241">241</a></span><span class="line">            <span class="comment">% Festlegen, welche VorgÃ¤nger mÃ¶glich sind:</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,242" id="srcline242">242</a></span><span class="line">            <span class="comment">% Es sind im Maximum die Anzahl der GÃ¤nge +  1 als VorgÃ¤nger</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,243" id="srcline243">243</a></span><span class="line">            <span class="comment">% mÃ¶glich, denn vom Segeln kann in jeden Gang im elektrischen</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,244" id="srcline244">244</a></span><span class="line">            <span class="comment">% Fahren und Segeln gewechselt  werden</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,245" id="srcline245">245</a></span><span class="line">            <span class="comment">%   Determine which predecessors are possible:</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,246" id="srcline246">246</a></span><span class="line">            <span class="comment">%   There are at maximum 'number of gears'+1 possible for the</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,247" id="srcline247">247</a></span><span class="line">            <span class="comment">%   predecessors, because from the sail in every Gear in</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,248" id="srcline248">248</a></span><span class="line">            <span class="comment">%   electric travel and the sails will be changed (???)</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,249" id="srcline249">249</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="81,250" id="srcline250">250</a></span><span class="line">            <span class="comment">% VorgÃ¤ngerzustÃ¤nde des Antriebsstrangs beschrÃ¤nken</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,251" id="srcline251">251</a></span><span class="line">            <span class="comment">%   determine gear possibilities - ie u(g) </span></span></span>
<span class="srcline"><span class="lineno"><a href="81,252" id="srcline252">252</a></span><span class="line">            <span class="mxinfo " id="T2:U200"><span class="var type1" id="S56T2U270">staPreMin</span> = <span class="mxinfo " id="T2:U202">max(<span class="mxinfo " id="T2:U203">1</span>,<span class="mxinfo " id="T2:U204"><span class="var type1" id="S49T2U275">staAct</span>-<span class="mxinfo " id="T2:U206">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,253" id="srcline253">253</a></span><span class="line">            <span class="mxinfo " id="T2:U207"><span class="var type1" id="S58T2U279">staPreMax</span> = <span class="mxinfo " id="T2:U209">min(<span class="var type1" id="S26T2U282">geaNum</span>,<span class="mxinfo " id="T2:U211"><span class="var type1" id="S49T2U284">staAct</span>+<span class="mxinfo " id="T2:U213">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,254" id="srcline254">254</a></span><span class="line">            <span class="mxinfo " id="T2:U214"><span class="var type1" id="S60T2U288">gea</span> = <span class="var type1" id="S49T2U289">staAct</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,255" id="srcline255">255</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="81,256" id="srcline256">256</a></span><span class="line">            <span class="comment">%% Schleife Ã¼ber alle kinetischen Energien (VorgÃ¤nger)</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,257" id="srcline257">257</a></span><span class="line">            <span class="comment">%   loop through all the kinetic energies (previous state idxs)</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,258" id="srcline258">258</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S61T2U292">engKinPreInx</span> = <span class="mxinfo " id="T2:U218">1</span>:<span class="var type1" id="S44T2U295">engKinNumPre</span> <span class="comment">% PREVIOUS KE LOOP</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,259" id="srcline259">259</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="81,260" id="srcline260">260</a></span><span class="line">                <span class="comment">% kinetsiche Energie des betrachten(consider) VorgÃ¤ngerspunkts</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,261" id="srcline261">261</a></span><span class="line">                <span class="comment">% bestimmen(determine)</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,262" id="srcline262">262</a></span><span class="line">                <span class="comment">%   determine the kinetic energy of the previous path_idx</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,263" id="srcline263">263</a></span><span class="line">                <span class="mxinfo " id="T2:U220"><span class="var type1" id="S62T2U298">engKinPre</span> = <span class="mxinfo " id="T2:U222"><span class="var type1" id="S45T41U300">engKinPreVec_engKinInx</span>(<span class="var type1" id="S61T2U301">engKinPreInx</span>)</span></span>; <span class="comment">%#ok&lt;PFBNS&gt;</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,264" id="srcline264">264</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="81,265" id="srcline265">265</a></span><span class="line">                <span class="comment">% PrÃ¼fen(check), ob eine erlaubte Beschleunigung vorliegt.</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,266" id="srcline266">266</a></span><span class="line">                <span class="comment">% Ansonsten zum nÃ¤chsten Schleifendurchlauf springen</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,267" id="srcline267">267</a></span><span class="line">                <span class="comment">%   Check whether an allowable acceleration exists.</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,268" id="srcline268">268</a></span><span class="line">                <span class="comment">%   Otherwise, jump to the next iteration</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,269" id="srcline269">269</a></span><span class="line">                <span class="mxinfo " id="T2:U225"><span class="var type1" id="S63T2U304">vehAcc</span> = <span class="mxinfo " id="T2:U227"><span class="mxinfo " id="T2:U228">(<span class="mxinfo " id="T2:U229"><span class="var type1" id="S48T2U309">engKinAct</span>-<span class="var type1" id="S62T2U310">engKinPre</span></span>)/<span class="var type1" id="S27T2U311">vehMas</span></span>/<span class="var type1" id="S7T2U312">wayStp</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,270" id="srcline270">270</a></span><span class="line">                <span class="keyword">if</span> ((<span class="mxinfo " id="T8:U234"><span class="var type1" id="S63T2U319">vehAcc</span> &lt; <span class="var type1" id="S28T2U320">vehAccMin</span></span>) || (<span class="mxinfo " id="T8:U237"><span class="var type1" id="S63T2U323">vehAcc</span> &gt; <span class="var type1" id="S29T2U324">vehAccMax</span></span>))</span></span>
<span class="srcline"><span class="lineno"><a href="81,271" id="srcline271">271</a></span><span class="line">                    <span class="keyword">continue</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,272" id="srcline272">272</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,273" id="srcline273">273</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="81,274" id="srcline274">274</a></span><span class="line">                <span class="comment">% Schleife Ã¼ber allen ZustÃ¤nde (relativer Index)</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,275" id="srcline275">275</a></span><span class="line">                <span class="comment">%   Loop through all the states (relative index)</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,276" id="srcline276">276</a></span><span class="line">                <span class="keyword">for</span> <span class="var type1" id="S64T2U328">staPre</span> = <span class="var type1" id="S56T2U330">staPreMin</span>:<span class="var type1" id="S58T2U331">staPreMax</span> <span class="comment">% CURRENT GEAR CHANGE LOOP</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,277" id="srcline277">277</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="81,278" id="srcline278">278</a></span><span class="line">                   </span></span>
<span class="srcline"><span class="lineno"><a href="81,279" id="srcline279">279</a></span><span class="line">                    <span class="comment">%% Batterieenergie beim betrachteten VorgÃ¤nger</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,280" id="srcline280">280</a></span><span class="line">                    <span class="comment">% battery energy when considering last path_idx</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,281" id="srcline281">281</a></span><span class="line">                    <span class="comment">%   note: batengPreMat has dims #_KE_states x #_gears</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,282" id="srcline282">282</a></span><span class="line">                    <span class="mxinfo " id="T2:U243"><span class="var type1" id="S65T2U334">batEng</span> = <span class="mxinfo " id="T2:U245"><span class="var type1" id="S36T45U336">batEngPreMat</span>(<span class="var type1" id="S61T2U337">engKinPreInx</span>,<span class="var type1" id="S64T2U338">staPre</span>)</span></span>;  <span class="comment">%#ok&lt;PFBNS&gt;</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,283" id="srcline283">283</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="81,284" id="srcline284">284</a></span><span class="line">                    <span class="comment">% Sollte es keinen gÃ¼ltigen VorgÃ¤nger geben, wird zum</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,285" id="srcline285">285</a></span><span class="line">                    <span class="comment">% nÃ¤chsten Schleifendurchlauf gesprungen</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,286" id="srcline286">286</a></span><span class="line">                    <span class="comment">%   if there is no valid previous battery energy, jump</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,287" id="srcline287">287</a></span><span class="line">                    <span class="comment">%   to the next loop iteration</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,288" id="srcline288">288</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo " id="T8:U249">isinf(<span class="var type1" id="S65T2U343">batEng</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,289" id="srcline289">289</a></span><span class="line">                        <span class="keyword">continue</span>; <span class="comment">% HOW TO OVERCOME INITIAL INFINITY VALUE?</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,290" id="srcline290">290</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,291" id="srcline291">291</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="81,292" id="srcline292">292</a></span><span class="line">                    <span class="comment">%% Antriebsstrangzustand und Strafkosten bestimmen   </span></span></span>
<span class="srcline"><span class="lineno"><a href="81,293" id="srcline293">293</a></span><span class="line">                    <span class="comment">%   determine gear and penalty costs</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,294" id="srcline294">294</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="81,295" id="srcline295">295</a></span><span class="line">                    <span class="comment">% Kosten fÃ¼r Zustandswechsel setzen</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,296" id="srcline296">296</a></span><span class="line">                    <span class="comment">%   set costs for state changes</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,297" id="srcline297">297</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo " id="T8:U251"><span class="var type1" id="S49T2U348">staAct</span> == <span class="var type1" id="S64T2U349">staPre</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="81,298" id="srcline298">298</a></span><span class="line">                        <span class="comment">% Entspricht der VorgÃ¤ngerzustand dem aktuellen </span></span></span>
<span class="srcline"><span class="lineno"><a href="81,299" id="srcline299">299</a></span><span class="line">                        <span class="comment">% Zustand werden keine Kosten gesetzt</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,300" id="srcline300">300</a></span><span class="line">                        <span class="comment">%   staying in current state? set penalty cost to 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,301" id="srcline301">301</a></span><span class="line">                        <span class="mxinfo " id="T2:U254"><span class="var type1" id="S67T2U352">staChgPenCos</span> = <span class="mxinfo " id="T2:U256">0</span></span>;                       </span></span>
<span class="srcline"><span class="lineno"><a href="81,302" id="srcline302">302</a></span><span class="line">                        </span></span>
<span class="srcline"><span class="lineno"><a href="81,303" id="srcline303">303</a></span><span class="line">                    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,304" id="srcline304">304</a></span><span class="line">                        <span class="comment">% Ansonsten einfache Zustandswechselkosten</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,305" id="srcline305">305</a></span><span class="line">                        <span class="comment">% berechnen</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,306" id="srcline306">306</a></span><span class="line">                        <span class="comment">%   otherwise apply a penalty cost to changing gear</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,307" id="srcline307">307</a></span><span class="line">                        <span class="mxinfo " id="T2:U257"><span class="var type1" id="S67T2U357">staChgPenCos</span> = <span class="var type1" id="S13T2U358">staChgPenCosVal</span></span>; <span class="comment">%&lt;-penCos is input</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,308" id="srcline308">308</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,309" id="srcline309">309</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="81,310" id="srcline310">310</a></span><span class="line">                                        </span></span>
<span class="srcline"><span class="lineno"><a href="81,311" id="srcline311">311</a></span><span class="line">                    <span class="comment">%% Berechnung der optimalen Kosten zum aktuellen Punkt</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,312" id="srcline312">312</a></span><span class="line">                    <span class="comment">%   calculating optimal cost to the current point</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,313" id="srcline313">313</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="81,314" id="srcline314">314</a></span><span class="line">                    <span class="comment">% externe Funktion ausfÃ¼hren, die minimale Kosten der</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,315" id="srcline315">315</a></span><span class="line">                    <span class="comment">% Hamiltonfunktion zurÃ¼ckgibt</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,316" id="srcline316">316</a></span><span class="line">                    <span class="comment">%   run the min-cost Hamiltonian finding function </span></span></span>
<span class="srcline"><span class="lineno"><a href="81,317" id="srcline317">317</a></span><span class="line">                    [<span class="mxinfo " id="T2:U260"><span class="var type1" id="S68T2U362">cosHam</span></span>,<span class="mxinfo " id="T2:U262"><span class="var type1" id="S69T2U363">batFrc</span></span>,<span class="mxinfo " id="T2:U264"><span class="var type1" id="S70T2U364">fulFrc</span></span>] = <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,318" id="srcline318">318</a></span><span class="line">                        <span class="fcn" id="F197N7:B366">clcPMP_olyHyb_port</span>(<span class="var type1" id="S62T2U367">engKinPre</span>,<span class="var type1" id="S48T2U368">engKinAct</span>,<span class="var type1" id="S60T2U369">gea</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,319" id="srcline319">319</a></span><span class="line">                        <span class="var type1" id="S39T2U370">slp</span>,<span class="mxinfo " id="T8:U270"><span class="var type1" id="S30T8U371">iceFlg</span></span>,<span class="var type1" id="S65T2U372">batEng</span>,<span class="var type1" id="S11T2U373">psiBatEng</span>,<span class="var type1" id="S12T2U374">psiTim</span>,<span class="var type1" id="S10T2U375">batPwrAux</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,320" id="srcline320">320</a></span><span class="line">                        <span class="var type1" id="S8T2U376">batEngStp</span>,<span class="var type1" id="S7T2U377">wayStp</span>,<span class="var type1" id="S24T34U378">fzg_scalar</span>, <span class="var type1" id="S25T35U379">fzg_array</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="81,321" id="srcline321">321</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="81,322" id="srcline322">322</a></span><span class="line"><span class="comment">%                     % minimale Kosten der Hamiltonfunktion zum aktuellen</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,323" id="srcline323">323</a></span><span class="line"><span class="comment">%                     % Punkt bestimmen</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,324" id="srcline324">324</a></span><span class="line"><span class="comment">%                     [cosHamMin,optPreInx] <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="81,325" id="srcline325">325</a></span><span class="line"><span class="comment">%                         = min([cosHam<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="81,326" id="srcline326">326</a></span><span class="line"><span class="comment">%                         + cos2goPreMat(engKinPreInx,staPre)<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="81,327" id="srcline327">327</a></span><span class="line"><span class="comment">%                         + staChgPenCos<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="81,328" id="srcline328">328</a></span><span class="line"><span class="comment">%                         ,cosHamMin]); %#ok&lt;PFBNS&gt;</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,329" id="srcline329">329</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="81,330" id="srcline330">330</a></span><span class="line">                    <span class="comment">% combine the min hamil. cost w/ previous costs and </span></span></span>
<span class="srcline"><span class="lineno"><a href="81,331" id="srcline331">331</a></span><span class="line">                    <span class="comment">%   gear penalty to get current cost</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,332" id="srcline332">332</a></span><span class="line">                    <span class="mxinfo " id="T2:U280"><span class="var type1" id="S72T2U382">cosAct</span> = <span class="mxinfo " id="T2:U282"><span class="mxinfo " id="T2:U283"><span class="var type1" id="S68T2U385">cosHam</span><span class="keyword">...</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="81,333" id="srcline333">333</a></span><span class="line"><span class="mxinfo " id="T2:U280"><span class="mxinfo " id="T2:U282"><span class="mxinfo " id="T2:U283">                        + <span class="mxinfo " id="T2:U285"><span class="var type1" id="S35T45U387">cos2goPreMat</span>(<span class="var type1" id="S61T2U388">engKinPreInx</span>,<span class="var type1" id="S64T2U389">staPre</span>)</span></span><span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="81,334" id="srcline334">334</a></span><span class="line"><span class="mxinfo " id="T2:U280"><span class="mxinfo " id="T2:U282">                        + <span class="mxinfo " id="T2:U289"><span class="var type1" id="S67T2U391">staChgPenCos</span>/<span class="var type1" id="S7T2U392">wayStp</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,335" id="srcline335">335</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="81,336" id="srcline336">336</a></span><span class="line">                    <span class="comment">% Wenn der aktuelle Punkt besser ist, als der in</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,337" id="srcline337">337</a></span><span class="line">                    <span class="comment">% cosHamMin gespeicherte Wert, werden die AusgabegrÃ¶ÃŸen</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,338" id="srcline338">338</a></span><span class="line">                    <span class="comment">% neu beschrieben.</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,339" id="srcline339">339</a></span><span class="line">                    <span class="comment">%   if current point is better than the cost value</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,340" id="srcline340">340</a></span><span class="line">                    <span class="comment">%   stored in CosHamMin, then rewrite the output</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,341" id="srcline341">341</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo " id="T8:U292"><span class="var type1" id="S72T2U396">cosAct</span> &lt; <span class="var type1" id="S50T2U397">cosHamMin</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="81,342" id="srcline342">342</a></span><span class="line">                        <span class="mxinfo " id="T2:U295"><span class="var type1" id="S50T2U400">cosHamMin</span> = <span class="var type1" id="S72T2U401">cosAct</span></span>;             <span class="comment">% new hamil. cost</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,343" id="srcline343">343</a></span><span class="line">                        <span class="mxinfo " id="T2:U298"><span class="var type1" id="S51T2U404">staPreOptInx</span> = <span class="var type1" id="S64T2U405">staPre</span></span>;          <span class="comment">% new optimal gear idx</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,344" id="srcline344">344</a></span><span class="line">                        <span class="mxinfo " id="T2:U301"><span class="var type1" id="S52T2U408">engKinPreOptInx</span> = <span class="var type1" id="S61T2U409">engKinPreInx</span></span>; <span class="comment">% new optimal KEidx</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,345" id="srcline345">345</a></span><span class="line">                        <span class="mxinfo " id="T2:U304"><span class="var type1" id="S54T2U412">batFrcOpt</span> = <span class="var type1" id="S69T2U413">batFrc</span></span>;             <span class="comment">% new optimal battery force</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,346" id="srcline346">346</a></span><span class="line">                        <span class="comment">% new opt. battery energy = (batt. force *</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,347" id="srcline347">347</a></span><span class="line">                        <span class="comment">% displacement diff) + previous battery energy valu</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,348" id="srcline348">348</a></span><span class="line">                        <span class="mxinfo " id="T2:U307"><span class="var type1" id="S55T2U416">batEngOpt</span> = <span class="mxinfo " id="T2:U309"><span class="mxinfo " id="T2:U310"><span class="var type1" id="S69T2U419">batFrc</span> * <span class="var type1" id="S7T2U420">wayStp</span></span> + <span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="81,349" id="srcline349">349</a></span><span class="line"><span class="mxinfo " id="T2:U307"><span class="mxinfo " id="T2:U309">                            <span class="mxinfo " id="T2:U313"><span class="var type1" id="S36T45U422">batEngPreMat</span>(<span class="var type1" id="S61T2U423">engKinPreInx</span>,<span class="var type1" id="S64T2U424">staPre</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,350" id="srcline350">350</a></span><span class="line">                        <span class="comment">% new opt. fuel energy = (fuel force * displacement</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,351" id="srcline351">351</a></span><span class="line">                        <span class="comment">% diff) + previous fuel energy value</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,352" id="srcline352">352</a></span><span class="line">                        <span class="mxinfo " id="T2:U317"><span class="var type1" id="S53T2U427">fulEngOpt</span> = <span class="mxinfo " id="T2:U319"><span class="mxinfo " id="T2:U320"><span class="var type1" id="S70T2U430">fulFrc</span> * <span class="var type1" id="S7T2U431">wayStp</span></span> + <span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="81,353" id="srcline353">353</a></span><span class="line"><span class="mxinfo " id="T2:U317"><span class="mxinfo " id="T2:U319">                            <span class="mxinfo " id="T2:U323"><span class="var type1" id="S37T45U433">fulEngPreMat</span>(<span class="var type1" id="S61T2U434">engKinPreInx</span>,<span class="var type1" id="S64T2U435">staPre</span>)</span></span></span>; <span class="comment">%#ok&lt;PFBNS&gt;</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,354" id="srcline354">354</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,355" id="srcline355">355</a></span><span class="line">                <span class="keyword">end</span> <span class="comment">% end of gear changes loop</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,356" id="srcline356">356</a></span><span class="line">            <span class="keyword">end</span> <span class="comment">% end of running through previous KE states loop</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,357" id="srcline357">357</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="81,358" id="srcline358">358</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T8:U327">~<span class="mxinfo " id="T8:U328">isinf(<span class="var type1" id="S50T2U441">cosHamMin</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="81,359" id="srcline359">359</a></span><span class="line">                <span class="comment">% optimale Kosten zum aktuellen Punkt speichern</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,360" id="srcline360">360</a></span><span class="line">                <span class="comment">%   save min hamilton value for current point</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,361" id="srcline361">361</a></span><span class="line">                <span class="mxinfo " id="T2:U330"><span class="mxinfo " id="T2:U331"><span class="var type1" id="S5T45U445">cos2goActMat</span>(<span class="var type1" id="S47T2U446">engKinActInx</span>,<span class="var type1" id="S49T2U447">staAct</span>)</span> = <span class="var type1" id="S50T2U448">cosHamMin</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,362" id="srcline362">362</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="81,363" id="srcline363">363</a></span><span class="line">                <span class="comment">% optimale Batterieenergie zum aktuellen Punkt speichern</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,364" id="srcline364">364</a></span><span class="line">                <span class="comment">%   save optimal battery energy for current point</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,365" id="srcline365">365</a></span><span class="line">                <span class="mxinfo " id="T2:U336"><span class="mxinfo " id="T2:U337"><span class="var type1" id="S41T45U452">batEngActMat</span>(<span class="var type1" id="S47T2U453">engKinActInx</span>,<span class="var type1" id="S49T2U454">staAct</span>)</span> = <span class="var type1" id="S55T2U455">batEngOpt</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,366" id="srcline366">366</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="81,367" id="srcline367">367</a></span><span class="line">                <span class="comment">% optimale Krafstoffenergie zum aktuellen Punkt speichern</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,368" id="srcline368">368</a></span><span class="line">                <span class="comment">%   save optimal fuel energy for current point</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,369" id="srcline369">369</a></span><span class="line">                <span class="mxinfo " id="T2:U342"><span class="mxinfo " id="T2:U343"><span class="var type1" id="S42T45U459">fulEngActMat</span>(<span class="var type1" id="S47T2U460">engKinActInx</span>,<span class="var type1" id="S49T2U461">staAct</span>)</span> = <span class="var type1" id="S53T2U462">fulEngOpt</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,370" id="srcline370">370</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="81,371" id="srcline371">371</a></span><span class="line">                <span class="comment">% optimale Batterieenergie zum aktuellen Punkt</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,372" id="srcline372">372</a></span><span class="line">                <span class="comment">% FlussgrÃ¶ÃŸe gilt im Intervall</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,373" id="srcline373">373</a></span><span class="line">                <span class="comment">%   populate optimal battery energy flux quantity at point </span></span></span>
<span class="srcline"><span class="lineno"><a href="81,374" id="srcline374">374</a></span><span class="line">                <span class="comment">%   that's applicable to current interval</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,375" id="srcline375">375</a></span><span class="line">                <span class="mxinfo " id="T2:U348"><span class="mxinfo " id="T2:U349"><span class="var type1" id="S40T45U466">batFrcOptMat</span>(<span class="var type1" id="S47T2U467">engKinActInx</span>,<span class="var type1" id="S49T2U468">staAct</span>)</span> = <span class="var type1" id="S54T2U469">batFrcOpt</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,376" id="srcline376">376</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="81,377" id="srcline377">377</a></span><span class="line">                <span class="comment">% optimalen VorgÃ¤nger codieren Ã¼ber Funktion sub2ind</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,378" id="srcline378">378</a></span><span class="line">                <span class="comment">% und speichern im Tensor</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,379" id="srcline379">379</a></span><span class="line">                <span class="comment">%   opt. predecessor idx encoding w/ sub2ind, store in Tn3</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,380" id="srcline380">380</a></span><span class="line">                <span class="mxinfo " id="T2:U354"><span class="mxinfo " id="T2:U355"><span class="var type1" id="S2T59U473">optPreInxTn3</span>(<span class="var type1" id="S47T2U474">engKinActInx</span>,<span class="var type1" id="S49T2U475">staAct</span>,<span class="var type1" id="S38T2U476">wayInx</span>)</span> = <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="81,381" id="srcline381">381</a></span><span class="line"><span class="mxinfo " id="T2:U354">                    <span class="mxinfo " id="T2:U360">sub2ind(<span class="mxinfo " id="T36:U361">[<span class="var type1" id="S17T2U481">engKinNum</span>,<span class="var type1" id="S18T2U482">staNum</span>]</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="81,382" id="srcline382">382</a></span><span class="line"><span class="mxinfo " id="T2:U354"><span class="mxinfo " id="T2:U360">                    <span class="var type1" id="S52T2U483">engKinPreOptInx</span>,<span class="var type1" id="S51T2U484">staPreOptInx</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,383" id="srcline383">383</a></span><span class="line">            <span class="keyword">end</span> <span class="comment">% end of ~inf(hamiltonian) if-statement</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,384" id="srcline384">384</a></span><span class="line">        <span class="keyword">end</span> <span class="comment">% end of looping through all gears</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,385" id="srcline385">385</a></span><span class="line">    <span class="keyword">end</span> <span class="comment">% end of looping through all the current kinetic energy states</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,386" id="srcline386">386</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="81,387" id="srcline387">387</a></span><span class="line">    <span class="comment">% Speichern der Batterieenergie fÃ¼r den nÃ¤chsten Schleifendurchlauf</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,388" id="srcline388">388</a></span><span class="line">    <span class="comment">%   save battery energy value as previous path_idx val for next loop </span></span></span>
<span class="srcline"><span class="lineno"><a href="81,389" id="srcline389">389</a></span><span class="line">    <span class="mxinfo " id="T45:U366"><span class="var type1" id="S36T45U487">batEngPreMat</span> = <span class="var type1" id="S41T45U488">batEngActMat</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,390" id="srcline390">390</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="81,391" id="srcline391">391</a></span><span class="line">    <span class="comment">% Speichern der Krafstoffenergie fÃ¼r den nÃ¤chsten Schleifendurchlauf</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,392" id="srcline392">392</a></span><span class="line">    <span class="comment">%   save fuel energy value as previous path_idx value for the next loop</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,393" id="srcline393">393</a></span><span class="line">    <span class="mxinfo " id="T45:U369"><span class="var type1" id="S37T45U491">fulEngPreMat</span> = <span class="var type1" id="S42T45U492">fulEngActMat</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,394" id="srcline394">394</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="81,395" id="srcline395">395</a></span><span class="line">    <span class="comment">% Speichern der Kosten fÃ¼r den nÃ¤chsten Schleifendurchlauf</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,396" id="srcline396">396</a></span><span class="line">    <span class="comment">%   save cost as previous path_idx value for the next loop</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,397" id="srcline397">397</a></span><span class="line">    <span class="mxinfo " id="T45:U372"><span class="var type1" id="S35T45U495">cos2goPreMat</span> = <span class="var type1" id="S5T45U496">cos2goActMat</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="81,398" id="srcline398">398</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="81,399" id="srcline399">399</a></span><span class="line">    <span class="comment">% optimale Kraftstoffenergie zum aktuellen Punkt</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,400" id="srcline400">400</a></span><span class="line">    <span class="comment">%   optimal fuel energy at current point - save current mat in tensor</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,401" id="srcline401">401</a></span><span class="line">    <span class="mxinfo " id="T45:U375"><span class="mxinfo " id="T45:U376"><span class="var type1" id="S4T59U500">fulEngOptTn3</span>(<span class="mxinfo " id="T71:U378">:</span>,<span class="mxinfo " id="T71:U379">:</span>,<span class="var type1" id="S38T2U503">wayInx</span>)</span> = <span class="var type1" id="S42T45U504">fulEngActMat</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,402" id="srcline402">402</a></span><span class="line">    <span class="comment">% optimale Batterieenergie zum aktuellen Punkt</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,403" id="srcline403">403</a></span><span class="line">    <span class="comment">%   optimal battery force at current point - save current mat in tensor</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,404" id="srcline404">404</a></span><span class="line">    <span class="comment">% FlussgrÃ¶ÃŸe gilt im Intervall</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,405" id="srcline405">405</a></span><span class="line">    <span class="comment">%   flux quantity applied over the interval</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,406" id="srcline406">406</a></span><span class="line">    <span class="mxinfo " id="T45:U382"><span class="mxinfo " id="T45:U383"><span class="var type1" id="S3T59U508">batFrcOptTn3</span>(<span class="mxinfo " id="T71:U385">:</span>,<span class="mxinfo " id="T71:U386">:</span>,<span class="mxinfo " id="T2:U387"><span class="var type1" id="S38T2U512">wayInx</span>-<span class="mxinfo " id="T2:U389">1</span></span>)</span> = <span class="var type1" id="S40T45U514">batFrcOptMat</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="81,407" id="srcline407">407</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="81,408" id="srcline408">408</a></span><span class="line">    <span class="comment">% Ausgabe des aktuellen Schleifendurchlaufs</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,409" id="srcline409">409</a></span><span class="line">    <span class="comment">%   output for current loop - print to terminal</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,410" id="srcline410">410</a></span><span class="line">    <span class="keyword">if</span> <span class="var type1" id="S6T2U517">disFlg</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,411" id="srcline411">411</a></span><span class="line">        fprintf(<span class="string">'Schleife %1.0f berechnet. %1.0f %% geschafft. \r'</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,412" id="srcline412">412</a></span><span class="line">            double(<span class="mxinfo " id="T2:U392"><span class="var type1" id="S38T2U525">wayInx</span>-<span class="var type1" id="S14T2U526">wayInxBeg</span></span>), <span class="mxinfo " id="T2:U395"><span class="mxinfo " id="T2:U396">double(((<span class="mxinfo " id="T2:U397"><span class="var type1" id="S38T2U534">wayInx</span>-<span class="var type1" id="S14T2U535">wayInxBeg</span></span>)))/<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="81,413" id="srcline413">413</a></span><span class="line"><span class="mxinfo " id="T2:U395"><span class="mxinfo " id="T2:U396">            double(<span class="mxinfo " id="T2:U400"><span class="var type1" id="S15T2U539">wayInxEnd</span>-<span class="var type1" id="S14T2U540">wayInxBeg</span></span>)</span>*<span class="mxinfo " id="T2:U403">100</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="81,414" id="srcline414">414</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,415" id="srcline415">415</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="81,416" id="srcline416">416</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% end of looping through all discretized path indexes</span></span></span>
<span class="srcline"><span class="lineno"><a href="81,417" id="srcline417">417</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="81,418" id="srcline418">418</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% END OF FUNCTION</span></span></span>
</pre>
