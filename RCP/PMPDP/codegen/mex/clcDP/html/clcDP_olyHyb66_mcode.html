<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="29,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="keyword">...</span><span class="comment">           --- AusgangsgrÃ¶ÃŸen:</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,2" id="srcline2">  2</a></span><span class="line">    <span class="var type1" id="S2T45U3">optPreInxTn3_old</span>, <span class="keyword">...</span><span class="comment">   Tensor 3. Stufe fÃ¼r opt. VorgÃ¤ngerkoordinaten</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,3" id="srcline3">  3</a></span><span class="line">    <span class="var type1" id="S3T45U4">batFrcOptTn3_old</span>, <span class="keyword">...</span><span class="comment">   Tensor 3. Stufe der Batteriekraft</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,4" id="srcline4">  4</a></span><span class="line">    <span class="var type1" id="S4T45U5">fulEngOptTn3_old</span>, <span class="keyword">...</span><span class="comment">   Tensor 3. Stufe fÃ¼r die Kraftstoffenergie </span></span></span>
<span class="srcline"><span class="lineno"><a href="29,5" id="srcline5">  5</a></span><span class="line">    <span class="var type1" id="S5T35U6">cos2goActMat_old</span> <span class="keyword">...</span><span class="comment">    Matrix der optimalen Kosten der Hamiltonfunktion </span></span></span>
<span class="srcline"><span class="lineno"><a href="29,6" id="srcline6">  6</a></span><span class="line">    ] = <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,7" id="srcline7">  7</a></span><span class="line">    clcDP_olyHyb<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,8" id="srcline8">  8</a></span><span class="line">    ( <span class="keyword">...</span><span class="comment">               --- EingangsgrÃ¶ÃŸen:</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,9" id="srcline9">  9</a></span><span class="line">    <span class="var type1" id="S6T2U9">disFlg</span>, <span class="keyword">...</span><span class="comment">         Skalar - Flag fÃ¼r Ausgabe in das Commandwindow</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,10" id="srcline10"> 10</a></span><span class="line">    <span class="var type1" id="S7T2U10">wayStp</span>,<span class="keyword">...</span><span class="comment">          Skalar fÃ¼r die Wegschrittweite in m</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,11" id="srcline11"> 11</a></span><span class="line">    <span class="var type1" id="S8T2U11">batEngStp</span>,<span class="keyword">...</span><span class="comment">       Skalar der Batteriediskretisierung in J</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,12" id="srcline12"> 12</a></span><span class="line">    <span class="var type1" id="S9T2U12">batEngBeg</span>,<span class="keyword">...</span><span class="comment">       Skalar fÃ¼r die Batterieenergie am Beginn in Ws</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,13" id="srcline13"> 13</a></span><span class="line">    <span class="var type1" id="S10T2U13">batPwrAux</span>,<span class="keyword">...</span><span class="comment">       Skalar fÃ¼r die Nebenverbrauchlast in W</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,14" id="srcline14"> 14</a></span><span class="line">    <span class="var type1" id="S11T2U14">psiBatEng</span>,<span class="keyword">...</span><span class="comment">       Skalar fÃ¼r den Co-State der Batterieenergie</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,15" id="srcline15"> 15</a></span><span class="line">    <span class="var type1" id="S12T2U15">psiTim</span>,<span class="keyword">...</span><span class="comment">          Skalar fÃ¼r den Co-State der Zeit</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,16" id="srcline16"> 16</a></span><span class="line">    <span class="var type1" id="S13T2U16">staChgPenCosVal</span>,<span class="keyword">...</span><span class="comment"> Skalar fÃ¼r die Strafkosten beim Zustandswechsel</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,17" id="srcline17"> 17</a></span><span class="line">    <span class="var type1" id="S14T2U17">wayInxBeg</span>,<span class="keyword">...</span><span class="comment">       Skalar fÃ¼r Anfangsindex in den Eingangsdaten</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,18" id="srcline18"> 18</a></span><span class="line">    <span class="var type1" id="S15T2U18">wayInxEnd</span>,<span class="keyword">...</span><span class="comment">       Skalar fÃ¼r Endindex in den Eingangsdaten</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,19" id="srcline19"> 19</a></span><span class="line">    <span class="var type1" id="S16T2U19">engKinBegInx</span>,<span class="keyword">...</span><span class="comment">    Skalar fÃ¼r den Index der Anfangsgeschwindigkeit</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,20" id="srcline20"> 20</a></span><span class="line">    <span class="var type1" id="S17T2U20">engKinNum</span>,<span class="keyword">...</span><span class="comment">       Skalar fÃ¼r die max. Anz. an engKin-StÃ¼tzstellen</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,21" id="srcline21"> 21</a></span><span class="line">    <span class="var type1" id="S18T2U21">staNum</span>,<span class="keyword">...</span><span class="comment">          Skalar fÃ¼r die max. Anzahl an ZustandsstÃ¼tzstellen</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,22" id="srcline22"> 22</a></span><span class="line">    <span class="var type1" id="S19T2U22">wayNum</span>,<span class="keyword">...</span><span class="comment">          Skalar fÃ¼r die Stufe der Batteriekraftmax. Anzahl an WegstÃ¼tzstellen</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,23" id="srcline23"> 23</a></span><span class="line">    <span class="var type1" id="S20T24U23">staBeg</span>,<span class="keyword">...</span><span class="comment">          Skalar fÃ¼r den Startzustand des Antriebsstrangs</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,24" id="srcline24"> 24</a></span><span class="line">    <span class="var type1" id="S21T24U24">engKinNumVec_wayInx</span>,<span class="keyword">...</span><span class="comment"> Vektor der Anzahl der kinetischen Energien</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,25" id="srcline25"> 25</a></span><span class="line">    <span class="var type1" id="S22T25U25">slpVec_wayInx</span>,<span class="keyword">...</span><span class="comment">   Vektor der Steigungen in rad</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,26" id="srcline26"> 26</a></span><span class="line">    <span class="var type1" id="S23T26U26">engKinMat_engKinInx_wayInx</span>,<span class="keyword">...</span><span class="comment"> Matrix der kinetischen Energien in J</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,27" id="srcline27"> 27</a></span><span class="line">    <span class="var type0" id="S24T0U27">FZG</span><span class="keyword">...</span><span class="comment">              struct der FahrzeugFZGameter</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,28" id="srcline28"> 28</a></span><span class="line">    )<span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%INIDP Calculating optimal predecessors with DP + PMP</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">% Erstellungsdatum der ersten Version 20.08.2015 - Stephan Uebel</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">% Diese Funktion berechnet die optimalen VorgÃ¤nger der Dynamischen</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">% Programmierung (DP). Diese subsitutiert die ZustÃ¤nde Zeit und</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">% Batterieenergie durch Co-States. Die Kosten werden mit dem</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">% Pontryaginschen Minimumsprinzip berechnet.</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,36" id="srcline36"> 36</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">% Variante olyHyb erlaubt nur hybridisches Fahren (Motor ist immer an)</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,38" id="srcline38"> 38</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">% Ã„nderung am 23.02.2016 - optimale Kosten nicht direkt aus Index von min()</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">% bestimmt. Das fÃ¤hrt zu einem anderen Schaltverhalten, da GÃ¤nge teilweise</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">% gleiche Kosten verursachen. In dem Fall wird jetzt der niedrigste Gang</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">% gewï¿½hlt, wie in der DP.</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,43" id="srcline43"> 43</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,44" id="srcline44"> 44</a></span><span class="line"><span class="comment">% !!!! Generelle Festlegung, wie Vektoren/Tensoren zu lesen sind !!!!</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">% Werte, die am Anfang und am Ende eines Intervalls gelten, stehen an der</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">% jeweiligen Position des Vektors.</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">% Mittelwerte, d.h. Flussgrï¿½ï¿½en wie Krï¿½fte, Leistungen etc., stehen immmer</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">% am Anfang des Intervalls fÃ¼r das folgende Intervall. Diese</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">% Vektoren/Tensoren sind daher um einen gï¿½ltigen Eintrag kÃ¼rzer.</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,50" id="srcline50"> 50</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">%% Initialisieren der persistent Grï¿½ï¿½en</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">% Diese werden die nur einmal fÃ¼r die Funktion berechnet</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">% assigning input structure values to function persistant variables - just</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">% once</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,55" id="srcline55"> 55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,56" id="srcline56"> 56</a></span><span class="line"><span class="keyword">persistent</span> <span class="var type0" id="S25T0U29">geaNum</span> <span class="var type0" id="S26T0U30">vehMas</span> <span class="var type0" id="S27T0U31">vehAccMin</span> <span class="var type0" id="S28T0U32">vehAccMax</span> <span class="var type0" id="S29T0U33">iceFlg</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,57" id="srcline57"> 57</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,58" id="srcline58"> 58</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T3:U23"><span class="mxinfo " id="T3:U24">isempty(<span class="var type0" id="S25T0U38">geaNum</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="29,59" id="srcline59"> 59</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,60" id="srcline60"> 60</a></span><span class="line">    <span class="comment">% Anzahl der GÃ¤nge</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,61" id="srcline61"> 61</a></span><span class="line">    <span class="comment">% number of gears</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,62" id="srcline62"> 62</a></span><span class="line">    <span class="mxinfo " id="T2:U25"><span class="var type1" id="S25T2U41">geaNum</span> = <span class="var type1" id="S18T2U42">staNum</span></span>; <span class="comment">% max number of state nodes</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,63" id="srcline63"> 63</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,64" id="srcline64"> 64</a></span><span class="line">    <span class="comment">% Fahrzeugmasse</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,65" id="srcline65"> 65</a></span><span class="line">    <span class="var type0" id="S26T0U45">vehMas</span> = <span class="var type0" id="S24T0U47"><span class="message error" id="M9F66C">FZG</span></span>.vehMas; </span></span>
<span class="srcline"><span class="lineno"><a href="29,66" id="srcline66"> 66</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,67" id="srcline67"> 67</a></span><span class="line">    <span class="comment">% minmiale und maximale Beschleunigung</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,68" id="srcline68"> 68</a></span><span class="line">    <span class="comment">% min and max accerlations (bounds)</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,69" id="srcline69"> 69</a></span><span class="line">    <span class="var type0" id="S27T0U51">vehAccMin</span> = <span class="var type0" id="S24T0U53"><span class="message error" id="M10F66C">FZG</span></span>.vehAccMin;</span></span>
<span class="srcline"><span class="lineno"><a href="29,70" id="srcline70"> 70</a></span><span class="line">    <span class="var type0" id="S28T0U57">vehAccMax</span> = <span class="var type0" id="S24T0U59"><span class="message error" id="M11F66C">FZG</span></span>.vehAccMax;</span></span>
<span class="srcline"><span class="lineno"><a href="29,71" id="srcline71"> 71</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,72" id="srcline72"> 72</a></span><span class="line">    <span class="comment">% In dieser Version ist der Motor immer an</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,73" id="srcline73"> 73</a></span><span class="line">    <span class="mxinfo " id="T3:U28"><span class="var type1" id="S29T3U63">iceFlg</span> = <span class="mxinfo " id="T3:U30">true</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,74" id="srcline74"> 74</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,75" id="srcline75"> 75</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,76" id="srcline76"> 76</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,77" id="srcline77"> 77</a></span><span class="line"><span class="comment">%% Initialisieren der Ausgabe der Funktion</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,78" id="srcline78"> 78</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,79" id="srcline79"> 79</a></span><span class="line"><span class="comment">% Tensor 3. Stufe fÃ¼r optimalen VorgÃ¤ngerkoordinaten</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,80" id="srcline80"> 80</a></span><span class="line"><span class="mxinfo " id="T45:U31"><span class="var type1" id="S2T45U68">optPreInxTn3_old</span> = <span class="mxinfo " id="T45:U33">zeros(<span class="var type1" id="S17T2U71">engKinNum</span>,<span class="var type1" id="S18T2U72">staNum</span>,<span class="var type1" id="S19T2U73">wayNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,81" id="srcline81"> 81</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,82" id="srcline82"> 82</a></span><span class="line"><span class="comment">% Tensor 3. Stufe fÃ¼r die Kraftstoffenergie</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,83" id="srcline83"> 83</a></span><span class="line"><span class="mxinfo " id="T45:U37"><span class="var type1" id="S4T45U76">fulEngOptTn3_old</span> = <span class="mxinfo " id="T45:U39">inf(<span class="var type1" id="S17T2U79">engKinNum</span>,<span class="var type1" id="S18T2U80">staNum</span>,<span class="var type1" id="S19T2U81">wayNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,84" id="srcline84"> 84</a></span><span class="line"><span class="comment">% set initial fuel energy level to 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,85" id="srcline85"> 85</a></span><span class="line"><span class="mxinfo " id="T47:U43"><span class="mxinfo " id="T47:U44"><span class="var type1" id="S4T45U85">fulEngOptTn3_old</span>(<span class="var type1" id="S16T2U86">engKinBegInx</span>,<span class="var type1" id="S20T24U87">staBeg</span>,<span class="var type1" id="S14T2U88">wayInxBeg</span>)</span> = <span class="mxinfo " id="T2:U49">0</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="29,86" id="srcline86"> 86</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,87" id="srcline87"> 87</a></span><span class="line"><span class="comment">% Tenor 3. Stufe fÃ¼r die Batterienergie</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,88" id="srcline88"> 88</a></span><span class="line"><span class="mxinfo " id="T45:U50"><span class="var type1" id="S3T45U92">batFrcOptTn3_old</span> = <span class="mxinfo " id="T45:U52">inf(<span class="var type1" id="S17T2U95">engKinNum</span>,<span class="var type1" id="S18T2U96">staNum</span>,<span class="var type1" id="S19T2U97">wayNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,89" id="srcline89"> 89</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,90" id="srcline90"> 90</a></span><span class="line"><span class="comment">%% Berechnung der optimalen VorgÃ¤nger</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,91" id="srcline91"> 91</a></span><span class="line"><span class="comment">% calculating the optimal predecessors</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,92" id="srcline92"> 92</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,93" id="srcline93"> 93</a></span><span class="line"><span class="comment">% Initialisieren der Matrix fÃ¼r die Kosten bis zu den Punkten im letzten</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,94" id="srcline94"> 94</a></span><span class="line"><span class="comment">% Wegschritt</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,95" id="srcline95"> 95</a></span><span class="line"><span class="comment">% initialize the matrix for the cost to the points in the last wayidx</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,96" id="srcline96"> 96</a></span><span class="line"><span class="mxinfo " id="T35:U56"><span class="var type1" id="S34T35U100">cos2goPreMat_old</span> = <span class="mxinfo " id="T35:U58">inf(<span class="var type1" id="S17T2U103">engKinNum</span>,<span class="var type1" id="S18T2U104">staNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,97" id="srcline97"> 97</a></span><span class="line"><span class="mxinfo " id="T35:U61"><span class="var type1" id="S5T35U107">cos2goActMat_old</span> = <span class="mxinfo " id="T35:U63">inf(<span class="var type1" id="S17T2U110">engKinNum</span>,<span class="var type1" id="S18T2U111">staNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,98" id="srcline98"> 98</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,99" id="srcline99"> 99</a></span><span class="line"><span class="comment">% Erste Initilisierung beim Startindex mit 0 fÃ¼r alle ZustÃ¤nde(concluded)</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,100" id="srcline100">100</a></span><span class="line"><span class="comment">% first, initialize the startidx to 0 for all states</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,101" id="srcline101">101</a></span><span class="line"><span class="mxinfo " id="T47:U66"><span class="mxinfo " id="T47:U67"><span class="var type1" id="S34T35U115">cos2goPreMat_old</span>(<span class="var type1" id="S16T2U116">engKinBegInx</span>,<span class="var type1" id="S20T24U117">staBeg</span>)</span> = <span class="mxinfo " id="T2:U71">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,102" id="srcline102">102</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,103" id="srcline103">103</a></span><span class="line"><span class="comment">% Initialisierung der Matrix der Batterieenergien</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,104" id="srcline104">104</a></span><span class="line"><span class="comment">% initialize the battery energy matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,105" id="srcline105">105</a></span><span class="line"><span class="mxinfo " id="T35:U72"><span class="var type1" id="S35T35U121">batEngPreMat_old</span> = <span class="mxinfo " id="T35:U74">inf(<span class="var type1" id="S17T2U124">engKinNum</span>,<span class="var type1" id="S18T2U125">staNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,106" id="srcline106">106</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,107" id="srcline107">107</a></span><span class="line"><span class="comment">% Erste Initilisierung beim Startindex mit Startladung fÃ¼r den Startzustand</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,108" id="srcline108">108</a></span><span class="line"><span class="comment">% first, intialize the start index of the starting charge for intial state</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,109" id="srcline109">109</a></span><span class="line"><span class="mxinfo " id="T47:U77"><span class="mxinfo " id="T47:U78"><span class="var type1" id="S35T35U129">batEngPreMat_old</span>(<span class="var type1" id="S16T2U130">engKinBegInx</span>,<span class="var type1" id="S20T24U131">staBeg</span>)</span> = <span class="var type1" id="S9T2U132">batEngBeg</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,110" id="srcline110">110</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,111" id="srcline111">111</a></span><span class="line"><span class="comment">% Initialisierung der Matrix der Kraftstoffenergien</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,112" id="srcline112">112</a></span><span class="line"><span class="comment">% initialze the fuel energy matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,113" id="srcline113">113</a></span><span class="line"><span class="mxinfo " id="T35:U83"><span class="var type1" id="S36T35U135">fulEngPreMat_old</span> = <span class="mxinfo " id="T35:U85">inf(<span class="var type1" id="S17T2U138">engKinNum</span>,<span class="var type1" id="S18T2U139">staNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,114" id="srcline114">114</a></span><span class="line"><span class="comment">% Erste Initilisierung beim Startindex mit 0 fÃ¼r den Startzustand</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,115" id="srcline115">115</a></span><span class="line"><span class="comment">% first, intialize the start idx for the intitial states to 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,116" id="srcline116">116</a></span><span class="line"><span class="mxinfo " id="T47:U88"><span class="mxinfo " id="T47:U89"><span class="var type1" id="S36T35U143">fulEngPreMat_old</span>(<span class="var type1" id="S16T2U144">engKinBegInx</span>,<span class="var type1" id="S20T24U145">staBeg</span>)</span> = <span class="mxinfo " id="T2:U93">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,117" id="srcline117">117</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,118" id="srcline118">118</a></span><span class="line"><span class="comment">% Schleife Ã¼ber alle Wegpunkte</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,119" id="srcline119">119</a></span><span class="line"><span class="comment">% looping thorugh length of # of grid discretization/indeces (Weginputs)</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,120" id="srcline120">120</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S37T2U149">wayInx</span> = <span class="mxinfo " id="T48:U95"><span class="mxinfo " id="T2:U96"><span class="var type1" id="S14T2U152">wayInxBeg</span>+<span class="mxinfo " id="T2:U98">1</span></span>:<span class="var type1" id="S15T2U154">wayInxEnd</span></span>      <span class="comment">% PATH IDX LOOP</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,121" id="srcline121">121</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,122" id="srcline122">122</a></span><span class="line">    <span class="comment">% mittlere Steigung im betrachteten Intervall #&lt;- no longer doing mean,</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,123" id="srcline123">123</a></span><span class="line">    <span class="comment">% using previous gradiant instead</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,124" id="srcline124">124</a></span><span class="line">    <span class="mxinfo " id="T2:U100"><span class="var type1" id="S38T2U157">slp_old</span> = <span class="mxinfo " id="T2:U102"><span class="var type1" id="S22T25U159">slpVec_wayInx</span>(<span class="mxinfo " id="T2:U104"><span class="var type1" id="S37T2U161">wayInx</span>-<span class="mxinfo " id="T2:U106">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,125" id="srcline125">125</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,126" id="srcline126">126</a></span><span class="line">    <span class="comment">%% Berechnung der kinetischen Energien im aktuellen Wegschritt</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,127" id="srcline127">127</a></span><span class="line">    <span class="comment">% Vorbereitung der FZGallen Schleife (verhindern von zu grossem</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,128" id="srcline128">128</a></span><span class="line">    <span class="comment">% Datentransfer und unnÃ¶tigen Berechnungen)</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,129" id="srcline129">129</a></span><span class="line">    <span class="comment">% Calculating the KE for current index/waypoint.</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,130" id="srcline130">130</a></span><span class="line">    <span class="comment">% Preperation of FZGallel loop (prevent a too large data transfer,</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,131" id="srcline131">131</a></span><span class="line">    <span class="comment">% unnecessary computations)    </span></span></span>
<span class="srcline"><span class="lineno"><a href="29,132" id="srcline132">132</a></span><span class="line">   </span></span>
<span class="srcline"><span class="lineno"><a href="29,133" id="srcline133">133</a></span><span class="line">    <span class="comment">% Initialisieren der Matrix fÃ¼r die optimalen Batteriekrafter im</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,134" id="srcline134">134</a></span><span class="line">    <span class="comment">% Intervall</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,135" id="srcline135">135</a></span><span class="line">    <span class="comment">% initialize matrix for optimale battery force intervals (discreti.)</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,136" id="srcline136">136</a></span><span class="line">    <span class="mxinfo " id="T35:U107"><span class="var type1" id="S39T35U165">batFrcOptMat_old</span> = <span class="mxinfo " id="T35:U109">inf(<span class="var type1" id="S17T2U168">engKinNum</span>,<span class="var type1" id="S18T2U169">staNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,137" id="srcline137">137</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="29,138" id="srcline138">138</a></span><span class="line">    <span class="comment">% Initialisieren der Matrix fÃ¼r die Kosten bis zu den Punkten im</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,139" id="srcline139">139</a></span><span class="line">    <span class="comment">% aktuellen Wegschritt</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,140" id="srcline140">140</a></span><span class="line">    <span class="comment">% initialize cost matrix to points in current path steps (idxs?)</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,141" id="srcline141">141</a></span><span class="line">    <span class="mxinfo " id="T35:U112"><span class="var type1" id="S5T35U172">cos2goActMat_old</span> = <span class="mxinfo " id="T35:U114">inf(<span class="var type1" id="S17T2U175">engKinNum</span>,<span class="var type1" id="S18T2U176">staNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,142" id="srcline142">142</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,143" id="srcline143">143</a></span><span class="line">    <span class="comment">% Initialisieren der Matrix fÃ¼r die Batterieenergie an den Punkten im</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,144" id="srcline144">144</a></span><span class="line">    <span class="comment">% aktuellen Wegschritt</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,145" id="srcline145">145</a></span><span class="line">    <span class="comment">% initialize matrix for battery energy at points along current way idxs</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,146" id="srcline146">146</a></span><span class="line">    <span class="mxinfo " id="T35:U117"><span class="var type1" id="S40T35U179">batEngActMat_old</span> = <span class="mxinfo " id="T35:U119">inf(<span class="var type1" id="S17T2U182">engKinNum</span>,<span class="var type1" id="S18T2U183">staNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,147" id="srcline147">147</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,148" id="srcline148">148</a></span><span class="line">    <span class="comment">% Initialisieren der Matrix fÃ¼r die Krafstoffenergie an den Punkten im</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,149" id="srcline149">149</a></span><span class="line">    <span class="comment">% aktuellen Wegschritt</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,150" id="srcline150">150</a></span><span class="line">    <span class="comment">% initialize matrix for fuel energie along current way idxs</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,151" id="srcline151">151</a></span><span class="line">    <span class="mxinfo " id="T35:U122"><span class="var type1" id="S41T35U186">fulEngActMat_old</span> = <span class="mxinfo " id="T35:U124">inf(<span class="var type1" id="S17T2U189">engKinNum</span>,<span class="var type1" id="S18T2U190">staNum</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,152" id="srcline152">152</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,153" id="srcline153">153</a></span><span class="line">    <span class="comment">% Anzahl der kinetischen Energien im aktuellen und im</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,154" id="srcline154">154</a></span><span class="line">    <span class="comment">% VorgÃ¤ngerwegschritt</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,155" id="srcline155">155</a></span><span class="line">    <span class="comment">% number of kinetic energies in current and past path_idxs</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,156" id="srcline156">156</a></span><span class="line">    <span class="mxinfo " id="T2:U127"><span class="var type1" id="S42T2U193">engKinNumAct_old</span> = <span class="mxinfo " id="T2:U129"><span class="var type1" id="S21T24U195">engKinNumVec_wayInx</span>(<span class="var type1" id="S37T2U196">wayInx</span>)</span></span>; <span class="comment">% look at this loop's KE</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,157" id="srcline157">157</a></span><span class="line">    <span class="mxinfo " id="T2:U132"><span class="var type1" id="S43T2U199">engKinNumPre_old</span> = <span class="mxinfo " id="T2:U134"><span class="var type1" id="S21T24U201">engKinNumVec_wayInx</span>(<span class="mxinfo " id="T2:U136"><span class="var type1" id="S37T2U203">wayInx</span>-<span class="mxinfo " id="T2:U138">1</span></span>)</span></span>; <span class="comment">% and the previous idx KE</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,158" id="srcline158">158</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,159" id="srcline159">159</a></span><span class="line">    <span class="comment">% Vektoren der kinetischen Energien im vorherigen Wegschritt</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,160" id="srcline160">160</a></span><span class="line">    <span class="comment">% ^^ vector of the KE in the previous idx</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,161" id="srcline161">161</a></span><span class="line">    <span class="mxinfo " id="T26:U139"><span class="var type1" id="S44T26U207">engKinPreVec_engKinInx_old</span> = <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="29,162" id="srcline162">162</a></span><span class="line"><span class="mxinfo " id="T26:U139">        <span class="var type1" id="S23T26U209">engKinMat_engKinInx_wayInx</span>(:,<span class="mxinfo " id="T2:U142"><span class="var type1" id="S37T2U212">wayInx</span>-<span class="mxinfo " id="T2:U144">1</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,163" id="srcline163">163</a></span><span class="line">    <span class="comment">% Vektoren der kinetischen Energien im aktuellen Wegschritt</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,164" id="srcline164">164</a></span><span class="line">    <span class="comment">% KE vector of the current path_idx</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,165" id="srcline165">165</a></span><span class="line">    <span class="mxinfo " id="T26:U145"><span class="var type1" id="S45T26U216">engKinActVec_engKinInx_old</span> = <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="29,166" id="srcline166">166</a></span><span class="line"><span class="mxinfo " id="T26:U145">        <span class="var type1" id="S23T26U218">engKinMat_engKinInx_wayInx</span>(:,<span class="var type1" id="S37T2U220">wayInx</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,167" id="srcline167">167</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,168" id="srcline168">168</a></span><span class="line">    <span class="comment">% (FZGfor) Schleife Ã¼ber alle akutellen kinetischen Energien</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,169" id="srcline169">169</a></span><span class="line">    <span class="comment">% loop through all the current kinetic energies</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,170" id="srcline170">170</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S46T2U223">engKinActInx</span> = <span class="mxinfo " id="T48:U150"><span class="mxinfo " id="T2:U151">1</span>:<span class="var type1" id="S42T2U226">engKinNumAct_old</span></span>   <span class="comment">% CURRENT KINETIC ENERGY LOOP</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,171" id="srcline171">171</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="29,172" id="srcline172">172</a></span><span class="line">        <span class="comment">% akutelle kinetsiche Energie bestimmen</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,173" id="srcline173">173</a></span><span class="line">        <span class="comment">% determine the current kinetic energy</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,174" id="srcline174">174</a></span><span class="line">        <span class="mxinfo " id="T26:U153"><span class="var type1" id="S47T26U229">engKinAct_old</span> = <span class="mxinfo " id="T2:U155"><span class="var type1" id="S45T26U231">engKinActVec_engKinInx_old</span>(<span class="var type1" id="S46T2U232">engKinActInx</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,175" id="srcline175">175</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="29,176" id="srcline176">176</a></span><span class="line">        <span class="comment">% Schleife Ã¼ber alle mÃ¶glichen aktuellen ZustÃ¤nde des Antriesstrangs</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,177" id="srcline177">177</a></span><span class="line">        <span class="comment">% Loop over all possible current powertrain states -- all the gears</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,178" id="srcline178">178</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S48T2U235">staAct_old</span> = <span class="mxinfo " id="T48:U159"><span class="mxinfo " id="T2:U160">1</span>:<span class="var type1" id="S18T2U238">staNum</span></span>           <span class="comment">% ALL GEARS LOOP</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,179" id="srcline179">179</a></span><span class="line">            <span class="comment">%% Initialsiieren</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,180" id="srcline180">180</a></span><span class="line">            <span class="comment">% note - you are preallocating over each powertrain state loop</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,181" id="srcline181">181</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="29,182" id="srcline182">182</a></span><span class="line">            <span class="comment">% Initialisieren der AusgabegrÃ¶ÃŸe der Schleife</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,183" id="srcline183">183</a></span><span class="line">            <span class="comment">% preallocate the loop's output size</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,184" id="srcline184">184</a></span><span class="line">            <span class="comment">% but this is the hamiltonian cost?</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,185" id="srcline185">185</a></span><span class="line">            <span class="mxinfo " id="T2:U162"><span class="var type1" id="S49T2U241">cosHamMin_old</span> = <span class="mxinfo " id="T2:U164">inf</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,186" id="srcline186">186</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="29,187" id="srcline187">187</a></span><span class="line">            <span class="comment">% Initialisieren der Variable fÃ¼r den optimalen Zustandsindex</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,188" id="srcline188">188</a></span><span class="line">            <span class="comment">% initializing variable for optimal state index</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,189" id="srcline189">189</a></span><span class="line">            <span class="mxinfo " id="T2:U165"><span class="var type1" id="S50T2U246">staPreOptInx_old</span> = <span class="mxinfo " id="T2:U167">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,190" id="srcline190">190</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="29,191" id="srcline191">191</a></span><span class="line">            <span class="comment">% Initialisieren der Variable fÃ¼r die Koordinaten des optimalen</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,192" id="srcline192">192</a></span><span class="line">            <span class="comment">% VorgÃ¤ngers</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,193" id="srcline193">193</a></span><span class="line">            <span class="comment">% initializing variable for optimal coords/KE for prev. idx</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,194" id="srcline194">194</a></span><span class="line">            <span class="mxinfo " id="T2:U168"><span class="var type1" id="S51T2U250">engKinPreOptInx_old</span> = <span class="mxinfo " id="T2:U170">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,195" id="srcline195">195</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="29,196" id="srcline196">196</a></span><span class="line">            <span class="comment">% Initialisieren der optimalen KraftstoffenergieÃ¤nderung zum</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,197" id="srcline197">197</a></span><span class="line">            <span class="comment">% betrachteten Punkt</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,198" id="srcline198">198</a></span><span class="line">            <span class="comment">% preallocate the optimum fuel energy change to the point</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,199" id="srcline199">199</a></span><span class="line">            <span class="comment">% considered</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,200" id="srcline200">200</a></span><span class="line">            <span class="mxinfo " id="T2:U171"><span class="var type1" id="S52T2U254">fulEngOpt_old</span> = <span class="mxinfo " id="T2:U173">inf</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,201" id="srcline201">201</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="29,202" id="srcline202">202</a></span><span class="line">            <span class="comment">% Initialisieren der optimalen Batteriekraft zum</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,203" id="srcline203">203</a></span><span class="line">            <span class="comment">% betrachteten Punkt</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,204" id="srcline204">204</a></span><span class="line">            <span class="comment">% preallocate the optimal battery force to the point under</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,205" id="srcline205">205</a></span><span class="line">            <span class="comment">% consideration</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,206" id="srcline206">206</a></span><span class="line">            <span class="mxinfo " id="T2:U174"><span class="var type1" id="S53T2U259">batFrcOpt_old</span> = <span class="mxinfo " id="T2:U176">inf</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,207" id="srcline207">207</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="29,208" id="srcline208">208</a></span><span class="line">            <span class="comment">% Initialisieren der optimalen Batterieenergie zum</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,209" id="srcline209">209</a></span><span class="line">            <span class="comment">% betrachteten Punkt</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,210" id="srcline210">210</a></span><span class="line">            <span class="comment">% initialize the optimal battery power (up to boundry limits)</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,211" id="srcline211">211</a></span><span class="line">            <span class="mxinfo " id="T2:U177"><span class="var type1" id="S54T2U264">batEngOpt_old</span> = <span class="mxinfo " id="T2:U179">inf</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,212" id="srcline212">212</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="29,213" id="srcline213">213</a></span><span class="line">            <span class="comment">%% VorgÃ¤ngerzustÃ¤nde beschrÃ¤nken</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,214" id="srcline214">214</a></span><span class="line">            <span class="comment">% Restrictions on predecessor operation states</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,215" id="srcline215">215</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="29,216" id="srcline216">216</a></span><span class="line">            <span class="comment">% Festlegen, welche VorgÃ¤nger mÃ¶glich sind:</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,217" id="srcline217">217</a></span><span class="line">            <span class="comment">% Es sind im Maximum die Anzahl der GÃ¤nge +  1 als VorgÃ¤nger</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,218" id="srcline218">218</a></span><span class="line">            <span class="comment">% mÃ¶glich, denn vom Segeln kann in jeden Gang im elektrischen</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,219" id="srcline219">219</a></span><span class="line">            <span class="comment">% Fahren und Segeln gewechselt  werden</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,220" id="srcline220">220</a></span><span class="line">            <span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,221" id="srcline221">221</a></span><span class="line">            <span class="comment">% Determine which predecessors are possible:</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,222" id="srcline222">222</a></span><span class="line">            <span class="comment">% There are at maximum 'number of gears'+1 possible for the</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,223" id="srcline223">223</a></span><span class="line">            <span class="comment">% predecessors, because from the sail in every Gear in electric</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,224" id="srcline224">224</a></span><span class="line">            <span class="comment">% travel and the sails will be changed (???)</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,225" id="srcline225">225</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="29,226" id="srcline226">226</a></span><span class="line">            <span class="comment">% VorgÃ¤ngerzustÃ¤nde des Antriebsstrangs beschrÃ¤nken</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,227" id="srcline227">227</a></span><span class="line">            <span class="comment">% determine gear possibilities - ie u(g) </span></span></span>
<span class="srcline"><span class="lineno"><a href="29,228" id="srcline228">228</a></span><span class="line">            <span class="mxinfo " id="T2:U180"><span class="var type1" id="S55T2U269">staPreMin_old</span> = <span class="mxinfo " id="T2:U182">max(<span class="mxinfo " id="T2:U183">1</span>,<span class="mxinfo " id="T2:U184"><span class="var type1" id="S48T2U274">staAct_old</span>-<span class="mxinfo " id="T2:U186">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,229" id="srcline229">229</a></span><span class="line">            <span class="mxinfo " id="T2:U187"><span class="var type1" id="S57T2U278">staPreMax_old</span> = <span class="mxinfo " id="T2:U189">min(<span class="var type1" id="S25T2U281">geaNum</span>,<span class="mxinfo " id="T2:U191"><span class="var type1" id="S48T2U283">staAct_old</span>+<span class="mxinfo " id="T2:U193">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,230" id="srcline230">230</a></span><span class="line">            <span class="mxinfo " id="T2:U194"><span class="var type1" id="S59T2U287">gea_old</span> = <span class="var type1" id="S48T2U288">staAct_old</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,231" id="srcline231">231</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="29,232" id="srcline232">232</a></span><span class="line">            <span class="comment">%% Schleife Ã¼ber alle kinetischen Energien (VorgÃ¤nger)</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,233" id="srcline233">233</a></span><span class="line">            <span class="comment">%   loop through all the kinetic energies (previous state idxs)</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,234" id="srcline234">234</a></span><span class="line">            <span class="keyword">for</span> <span class="var type1" id="S60T2U291">engKinPreInx</span> = <span class="mxinfo " id="T48:U198"><span class="mxinfo " id="T2:U199">1</span>:<span class="var type1" id="S43T2U294">engKinNumPre_old</span></span> <span class="comment">% PREVIOUS KE LOOP</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,235" id="srcline235">235</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="29,236" id="srcline236">236</a></span><span class="line">                <span class="comment">% kinetsiche Energie des betrachten(consider) VorgÃ¤ngerspunkts</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,237" id="srcline237">237</a></span><span class="line">                <span class="comment">% bestimmen(determine)</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,238" id="srcline238">238</a></span><span class="line">                <span class="comment">%   determine the kinetic energy of the previous path_idx</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,239" id="srcline239">239</a></span><span class="line">                <span class="mxinfo " id="T26:U201"><span class="var type1" id="S61T26U297">engKinPre_old</span> = <span class="mxinfo " id="T2:U203"><span class="var type1" id="S44T26U299">engKinPreVec_engKinInx_old</span>(<span class="var type1" id="S60T2U300">engKinPreInx</span>)</span></span>; <span class="comment">%#ok&lt;PFBNS&gt;</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,240" id="srcline240">240</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="29,241" id="srcline241">241</a></span><span class="line">                <span class="comment">% PrÃ¼fen(check), ob eine erlaubte Beschleunigung vorliegt.</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,242" id="srcline242">242</a></span><span class="line">                <span class="comment">% Ansonsten zum nÃ¤chsten Schleifendurchlauf springen</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,243" id="srcline243">243</a></span><span class="line">                <span class="comment">%   Check whether an allowable acceleration exists.</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,244" id="srcline244">244</a></span><span class="line">                <span class="comment">%   Otherwise, jump to the next iteration</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,245" id="srcline245">245</a></span><span class="line">                <span class="var type0" id="S62T0U303">vehAcc_old</span> = (<span class="mxinfo " id="T26:U206"><span class="var type1" id="S47T26U308"><span class="message error" id="M12F66C">engKinAct_old</span></span></span>-<span class="var type1" id="S61T26U309">engKinPre_old</span>)/<span class="var type0" id="S26T0U310">vehMas</span>/<span class="var type0" id="S7T0U311">wayStp</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,246" id="srcline246">246</a></span><span class="line">                <span class="keyword">if</span> <span class="var type0" id="S62T0U316"><span class="message error" id="M13F66C">vehAcc_old</span></span> &lt; <span class="var type0" id="S27T0U317">vehAccMin</span> || <span class="var type0" id="S62T0U319"><span class="message error" id="M14F66C">vehAcc_old</span></span> &gt; <span class="var type0" id="S28T0U320">vehAccMax</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,247" id="srcline247">247</a></span><span class="line">                    <span class="keyword">continue</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,248" id="srcline248">248</a></span><span class="line">                <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,249" id="srcline249">249</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,250" id="srcline250">250</a></span><span class="line">                <span class="comment">% Schleife Ã¼ber allen ZustÃ¤nde (relativer Index)</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,251" id="srcline251">251</a></span><span class="line">                <span class="comment">%   Loop through all the states (relative index)</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,252" id="srcline252">252</a></span><span class="line">                <span class="keyword">for</span> <span class="var type1" id="S63T2U324">staPre</span> = <span class="mxinfo " id="T48:U209"><span class="var type1" id="S55T2U326">staPreMin_old</span>:<span class="var type1" id="S57T2U327">staPreMax_old</span></span> <span class="comment">% CURRENT GEAR CHANGE LOOP</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,253" id="srcline253">253</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="29,254" id="srcline254">254</a></span><span class="line">                   </span></span>
<span class="srcline"><span class="lineno"><a href="29,255" id="srcline255">255</a></span><span class="line">                    <span class="comment">%% Batterieenergie beim betrachteten VorgÃ¤nger</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,256" id="srcline256">256</a></span><span class="line">                    <span class="comment">% battery energy when considering last path_idx</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,257" id="srcline257">257</a></span><span class="line">                    <span class="comment">%   note: batengPreMat has dims #_KE_states x #_gears</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,258" id="srcline258">258</a></span><span class="line">                    <span class="mxinfo " id="T2:U212"><span class="var type1" id="S64T2U330">batEng_old</span> = <span class="mxinfo " id="T2:U214"><span class="var type1" id="S35T35U332">batEngPreMat_old</span>(<span class="var type1" id="S60T2U333">engKinPreInx</span>,<span class="var type1" id="S63T2U334">staPre</span>)</span></span>;  <span class="comment">%#ok&lt;PFBNS&gt;</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,259" id="srcline259">259</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="29,260" id="srcline260">260</a></span><span class="line">                    <span class="comment">% Sollte es keinen gÃ¼ltigen VorgÃ¤nger geben, wird zum</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,261" id="srcline261">261</a></span><span class="line">                    <span class="comment">% nÃ¤chsten Schleifendurchlauf gesprungen</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,262" id="srcline262">262</a></span><span class="line">                    <span class="comment">%   if there is no valid previous battery energy, jump</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,263" id="srcline263">263</a></span><span class="line">                    <span class="comment">%   to the next loop iteration</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,264" id="srcline264">264</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo " id="T3:U218">isinf(<span class="var type1" id="S64T2U339">batEng_old</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,265" id="srcline265">265</a></span><span class="line">                        <span class="keyword">continue</span>; <span class="comment">% HOW TO OVERCOME INITIAL INFINITY VALUE?</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,266" id="srcline266">266</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,267" id="srcline267">267</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="29,268" id="srcline268">268</a></span><span class="line">                    <span class="comment">%% Antriebsstrangzustand und Strafkosten bestimmen   </span></span></span>
<span class="srcline"><span class="lineno"><a href="29,269" id="srcline269">269</a></span><span class="line">                    <span class="comment">% determine gear and penalty costs</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,270" id="srcline270">270</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="29,271" id="srcline271">271</a></span><span class="line">                    <span class="comment">% Kosten fÃ¼r Zustandswechsel setzen</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,272" id="srcline272">272</a></span><span class="line">                    <span class="comment">% set costs for state changes</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,273" id="srcline273">273</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo " id="T3:U220"><span class="var type1" id="S48T2U344">staAct_old</span> == <span class="var type1" id="S63T2U345">staPre</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="29,274" id="srcline274">274</a></span><span class="line">                        <span class="comment">% Entspricht der VorgÃ¤ngerzustand dem aktuellen </span></span></span>
<span class="srcline"><span class="lineno"><a href="29,275" id="srcline275">275</a></span><span class="line">                        <span class="comment">% Zustand werden keine Kosten gesetzt</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,276" id="srcline276">276</a></span><span class="line">                        <span class="comment">% staying in current state? set penalty cost to 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,277" id="srcline277">277</a></span><span class="line">                        <span class="mxinfo " id="T2:U223"><span class="var type1" id="S66T2U348">staChgPenCos_old</span> = <span class="mxinfo " id="T2:U225">0</span></span>;                       </span></span>
<span class="srcline"><span class="lineno"><a href="29,278" id="srcline278">278</a></span><span class="line">                        </span></span>
<span class="srcline"><span class="lineno"><a href="29,279" id="srcline279">279</a></span><span class="line">                    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,280" id="srcline280">280</a></span><span class="line">                        <span class="comment">% Ansonsten einfache Zustandswechselkosten</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,281" id="srcline281">281</a></span><span class="line">                        <span class="comment">% berechnen</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,282" id="srcline282">282</a></span><span class="line">                        <span class="comment">% otherwise apply a penalty cost to changing gear</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,283" id="srcline283">283</a></span><span class="line">                        <span class="mxinfo " id="T2:U226"><span class="var type1" id="S66T2U353">staChgPenCos_old</span> = <span class="var type1" id="S13T2U354">staChgPenCosVal</span></span>; <span class="comment">%&lt;-penCos is input</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,284" id="srcline284">284</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,285" id="srcline285">285</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="29,286" id="srcline286">286</a></span><span class="line">                                        </span></span>
<span class="srcline"><span class="lineno"><a href="29,287" id="srcline287">287</a></span><span class="line">                    <span class="comment">%% Berechnung der optimalen Kosten zum aktuellen Punkt</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,288" id="srcline288">288</a></span><span class="line">                    <span class="comment">% calculating optimal cost to the current point</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,289" id="srcline289">289</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="29,290" id="srcline290">290</a></span><span class="line">                    <span class="comment">% externe Funktion ausfÃ¼hren, die minimale Kosten der</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,291" id="srcline291">291</a></span><span class="line">                    <span class="comment">% Hamiltonfunktion zurÃ¼ckgibt</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,292" id="srcline292">292</a></span><span class="line">                    <span class="comment">% run the min-cost Hamiltonian finding function </span></span></span>
<span class="srcline"><span class="lineno"><a href="29,293" id="srcline293">293</a></span><span class="line">                    [<span class="var type0" id="S67T0U358"><span class="message error" id="M16F66C">cosHam_old</span></span>,<span class="var type0" id="S68T0U359"><span class="message error" id="M17F66C">batFrc_old</span></span>,<span class="var type0" id="S69T0U360"><span class="message error" id="M18F66C">fulFrc_old</span></span>] = <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,294" id="srcline294">294</a></span><span class="line">                        clcPMP_olyHyb(<span class="var type1" id="S61T26U363">engKinPre_old</span>,<span class="var type1" id="S47T26U364">engKinAct_old</span>,<span class="var type1" id="S59T2U365">gea_old</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,295" id="srcline295">295</a></span><span class="line">                        <span class="var type1" id="S38T2U366">slp_old</span>,<span class="var type1" id="S29T3U367">iceFlg</span>,<span class="var type1" id="S64T2U368">batEng_old</span>,<span class="var type1" id="S11T2U369">psiBatEng</span>,<span class="var type1" id="S12T2U370">psiTim</span>,<span class="var type1" id="S10T2U371">batPwrAux</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,296" id="srcline296">296</a></span><span class="line">                        <span class="var type1" id="S8T2U372">batEngStp</span>,<span class="var type1" id="S7T2U373">wayStp</span>,<span class="var type0" id="S24T0U374"><span class="message error" id="M15F66C">FZG</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="29,297" id="srcline297">297</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="29,298" id="srcline298">298</a></span><span class="line"><span class="comment">%                     % minimale Kosten der Hamiltonfunktion zum aktuellen</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,299" id="srcline299">299</a></span><span class="line"><span class="comment">%                     % Punkt bestimmen</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,300" id="srcline300">300</a></span><span class="line"><span class="comment">%                     [cosHamMin,optPreInx] <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="29,301" id="srcline301">301</a></span><span class="line"><span class="comment">%                         = min([cosHam<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="29,302" id="srcline302">302</a></span><span class="line"><span class="comment">%                         + cos2goPreMat(engKinPreInx,staPre)<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="29,303" id="srcline303">303</a></span><span class="line"><span class="comment">%                         + staChgPenCos<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="29,304" id="srcline304">304</a></span><span class="line"><span class="comment">%                         ,cosHamMin]); %#ok&lt;PFBNS&gt;</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,305" id="srcline305">305</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="29,306" id="srcline306">306</a></span><span class="line">                    <span class="comment">% combine the min hamil. cost w/ previous costs and </span></span></span>
<span class="srcline"><span class="lineno"><a href="29,307" id="srcline307">307</a></span><span class="line">                    <span class="comment">% gear penalty to get current cost</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,308" id="srcline308">308</a></span><span class="line">                    <span class="var type0" id="S71T0U377">cosAct_old</span> = <span class="var type0" id="S67T0U380"><span class="message error" id="M19F66C">cosHam_old</span></span><span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,309" id="srcline309">309</a></span><span class="line">                        + <span class="var type0" id="S34T0U382">cos2goPreMat_old</span>(<span class="var type0" id="S60T0U383">engKinPreInx</span>,<span class="var type0" id="S63T0U384">staPre</span>)<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,310" id="srcline310">310</a></span><span class="line">                        + <span class="var type0" id="S66T0U386">staChgPenCos_old</span>/<span class="var type0" id="S7T0U387">wayStp</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,311" id="srcline311">311</a></span><span class="line">                    </span></span>
<span class="srcline"><span class="lineno"><a href="29,312" id="srcline312">312</a></span><span class="line">                    <span class="comment">% Wenn der aktuelle Punkt besser ist, als der in</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,313" id="srcline313">313</a></span><span class="line">                    <span class="comment">% cosHamMin gespeicherte Wert, werden die AusgabegrÃ¶ÃŸen</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,314" id="srcline314">314</a></span><span class="line">                    <span class="comment">% neu beschrieben.</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,315" id="srcline315">315</a></span><span class="line">                    <span class="comment">% if current point is better than the cost value stored</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,316" id="srcline316">316</a></span><span class="line">                    <span class="comment">% in CosHamMin, then rewrite the output</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,317" id="srcline317">317</a></span><span class="line">                    <span class="keyword">if</span> <span class="var type0" id="S71T0U391"><span class="message error" id="M20F66C">cosAct_old</span></span> &lt; <span class="var type0" id="S49T0U392">cosHamMin_old</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,318" id="srcline318">318</a></span><span class="line">                        <span class="var type0" id="S49T0U395">cosHamMin_old</span> = <span class="var type0" id="S71T0U396"><span class="message error" id="M21F66C">cosAct_old</span></span>;             <span class="comment">% new hamil. cost</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,319" id="srcline319">319</a></span><span class="line">                        <span class="mxinfo " id="T2:U240"><span class="var type1" id="S50T2U399">staPreOptInx_old</span> = <span class="var type1" id="S63T2U400">staPre</span></span>;          <span class="comment">% new optimal gear idx</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,320" id="srcline320">320</a></span><span class="line">                        <span class="mxinfo " id="T2:U243"><span class="var type1" id="S51T2U403">engKinPreOptInx_old</span> = <span class="var type1" id="S60T2U404">engKinPreInx</span></span>; <span class="comment">% new optimal KEidx</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,321" id="srcline321">321</a></span><span class="line">                        <span class="var type0" id="S53T0U407">batFrcOpt_old</span> = <span class="var type0" id="S68T0U408"><span class="message error" id="M22F66C">batFrc_old</span></span>;             <span class="comment">% new optimal battery force</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,322" id="srcline322">322</a></span><span class="line">                        <span class="comment">% new opt. battery energy = (batt. force *</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,323" id="srcline323">323</a></span><span class="line">                        <span class="comment">% displacement diff) + previous battery energy valu</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,324" id="srcline324">324</a></span><span class="line">                        <span class="var type0" id="S54T0U411">batEngOpt_old</span> = <span class="var type0" id="S68T0U414"><span class="message error" id="M23F66C">batFrc_old</span></span> * <span class="var type0" id="S7T0U415">wayStp</span> + <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,325" id="srcline325">325</a></span><span class="line">                            <span class="var type0" id="S35T0U417">batEngPreMat_old</span>(<span class="var type0" id="S60T0U418">engKinPreInx</span>,<span class="var type0" id="S63T0U419">staPre</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="29,326" id="srcline326">326</a></span><span class="line">                        <span class="comment">% new opt. fuel energy = (fuel force * displacement</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,327" id="srcline327">327</a></span><span class="line">                        <span class="comment">% diff) + previous fuel energy value</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,328" id="srcline328">328</a></span><span class="line">                        <span class="var type0" id="S52T0U422">fulEngOpt_old</span> = <span class="var type0" id="S69T0U425"><span class="message error" id="M24F66C">fulFrc_old</span></span> * <span class="var type0" id="S7T0U426">wayStp</span> + <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,329" id="srcline329">329</a></span><span class="line">                            <span class="var type0" id="S36T0U428">fulEngPreMat_old</span>(<span class="var type0" id="S60T0U429">engKinPreInx</span>,<span class="var type0" id="S63T0U430">staPre</span>); <span class="comment">%#ok&lt;PFBNS&gt;</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,330" id="srcline330">330</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,331" id="srcline331">331</a></span><span class="line">                <span class="keyword">end</span> <span class="comment">% end of gear changes loop</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,332" id="srcline332">332</a></span><span class="line">            <span class="keyword">end</span> <span class="comment">% end of running through previous KE states loop</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,333" id="srcline333">333</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="29,334" id="srcline334">334</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T3:U246">~<span class="mxinfo " id="T3:U247">isinf(<span class="var type1" id="S49T2U436">cosHamMin_old</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="29,335" id="srcline335">335</a></span><span class="line">                <span class="comment">% optimale Kosten zum aktuellen Punkt speichern</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,336" id="srcline336">336</a></span><span class="line">                <span class="comment">% save min hamilton value for current point</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,337" id="srcline337">337</a></span><span class="line">                <span class="mxinfo " id="T2:U249"><span class="mxinfo " id="T2:U250"><span class="var type1" id="S5T35U440">cos2goActMat_old</span>(<span class="var type1" id="S46T2U441">engKinActInx</span>,<span class="var type1" id="S48T2U442">staAct_old</span>)</span> = <span class="var type1" id="S49T2U443">cosHamMin_old</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,338" id="srcline338">338</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="29,339" id="srcline339">339</a></span><span class="line">                <span class="comment">% optimale Batterieenergie zum aktuellen Punkt speichern</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,340" id="srcline340">340</a></span><span class="line">                <span class="comment">% save optimal battery energy for current point</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,341" id="srcline341">341</a></span><span class="line">                <span class="mxinfo " id="T2:U255"><span class="mxinfo " id="T2:U256"><span class="var type1" id="S40T35U447">batEngActMat_old</span>(<span class="var type1" id="S46T2U448">engKinActInx</span>,<span class="var type1" id="S48T2U449">staAct_old</span>)</span> = <span class="var type1" id="S54T2U450">batEngOpt_old</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,342" id="srcline342">342</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="29,343" id="srcline343">343</a></span><span class="line">                <span class="comment">% optimale Krafstoffenergie zum aktuellen Punkt speichern</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,344" id="srcline344">344</a></span><span class="line">                <span class="comment">% save optimal fuel energy for current point</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,345" id="srcline345">345</a></span><span class="line">                <span class="mxinfo " id="T2:U261"><span class="mxinfo " id="T2:U262"><span class="var type1" id="S41T35U454">fulEngActMat_old</span>(<span class="var type1" id="S46T2U455">engKinActInx</span>,<span class="var type1" id="S48T2U456">staAct_old</span>)</span> = <span class="var type1" id="S52T2U457">fulEngOpt_old</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,346" id="srcline346">346</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,347" id="srcline347">347</a></span><span class="line">                <span class="comment">% optimale Batterieenergie zum aktuellen Punkt</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,348" id="srcline348">348</a></span><span class="line">                <span class="comment">% FlussgrÃ¶ÃŸe gilt im Intervall</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,349" id="srcline349">349</a></span><span class="line">                <span class="comment">% populate optimal battery energy flux quantity at point </span></span></span>
<span class="srcline"><span class="lineno"><a href="29,350" id="srcline350">350</a></span><span class="line">                <span class="comment">% that's applicable to current interval</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,351" id="srcline351">351</a></span><span class="line">                <span class="mxinfo " id="T2:U267"><span class="mxinfo " id="T2:U268"><span class="var type1" id="S39T35U461">batFrcOptMat_old</span>(<span class="var type1" id="S46T2U462">engKinActInx</span>,<span class="var type1" id="S48T2U463">staAct_old</span>)</span> = <span class="var type1" id="S53T2U464">batFrcOpt_old</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,352" id="srcline352">352</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="29,353" id="srcline353">353</a></span><span class="line">                <span class="comment">% optimalen VorgÃ¤nger codieren Ã¼ber Funktion sub2ind</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,354" id="srcline354">354</a></span><span class="line">                <span class="comment">% und speichern im Tensor</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,355" id="srcline355">355</a></span><span class="line">                <span class="comment">% opt. predecessor idx encoding w/ sub2ind, store in tensor</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,356" id="srcline356">356</a></span><span class="line">                <span class="mxinfo " id="T2:U273"><span class="mxinfo " id="T2:U274"><span class="var type1" id="S2T45U468">optPreInxTn3_old</span>(<span class="var type1" id="S46T2U469">engKinActInx</span>,<span class="var type1" id="S48T2U470">staAct_old</span>,<span class="var type1" id="S37T2U471">wayInx</span>)</span> = <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="29,357" id="srcline357">357</a></span><span class="line"><span class="mxinfo " id="T2:U273">                    <span class="mxinfo " id="T2:U279">sub2ind(<span class="mxinfo " id="T27:U280">[<span class="var type1" id="S17T2U476">engKinNum</span>,<span class="var type1" id="S18T2U477">staNum</span>]</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="29,358" id="srcline358">358</a></span><span class="line"><span class="mxinfo " id="T2:U273"><span class="mxinfo " id="T2:U279">                    <span class="var type1" id="S51T2U478">engKinPreOptInx_old</span>,<span class="var type1" id="S50T2U479">staPreOptInx_old</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,359" id="srcline359">359</a></span><span class="line">            <span class="keyword">end</span> <span class="comment">% end of ~inf(hamiltonian) if-statement</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,360" id="srcline360">360</a></span><span class="line">        <span class="keyword">end</span> <span class="comment">% end of looping through all gears</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,361" id="srcline361">361</a></span><span class="line">    <span class="keyword">end</span> <span class="comment">% end of looping through all the current kinetic energy states</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,362" id="srcline362">362</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,363" id="srcline363">363</a></span><span class="line">    <span class="comment">% Speichern der Batterieenergie fÃ¼r den nÃ¤chsten Schleifendurchlauf</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,364" id="srcline364">364</a></span><span class="line">    <span class="comment">% save battery energy value as previous path_idx val for the next loop </span></span></span>
<span class="srcline"><span class="lineno"><a href="29,365" id="srcline365">365</a></span><span class="line">    <span class="mxinfo " id="T35:U285"><span class="var type1" id="S35T35U482">batEngPreMat_old</span> = <span class="var type1" id="S40T35U483">batEngActMat_old</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,366" id="srcline366">366</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,367" id="srcline367">367</a></span><span class="line">    <span class="comment">% Speichern der Krafstoffenergie fÃ¼r den nÃ¤chsten Schleifendurchlauf</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,368" id="srcline368">368</a></span><span class="line">    <span class="comment">% save fuel energy value as previous path_idx value for the next loop</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,369" id="srcline369">369</a></span><span class="line">    <span class="mxinfo " id="T35:U288"><span class="var type1" id="S36T35U486">fulEngPreMat_old</span> = <span class="var type1" id="S41T35U487">fulEngActMat_old</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,370" id="srcline370">370</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,371" id="srcline371">371</a></span><span class="line">    <span class="comment">% Speichern der Kosten fÃ¼r den nÃ¤chsten Schleifendurchlauf</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,372" id="srcline372">372</a></span><span class="line">    <span class="comment">% save cost as previous path_idx value for the next loop</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,373" id="srcline373">373</a></span><span class="line">    <span class="mxinfo " id="T35:U291"><span class="var type1" id="S34T35U490">cos2goPreMat_old</span> = <span class="var type1" id="S5T35U491">cos2goActMat_old</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="29,374" id="srcline374">374</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,375" id="srcline375">375</a></span><span class="line">    <span class="comment">% optimale Kraftstoffenergie zum aktuellen Punkt</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,376" id="srcline376">376</a></span><span class="line">    <span class="comment">% optimal fuel energy at current point - save current mat in tensor</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,377" id="srcline377">377</a></span><span class="line">    <span class="mxinfo " id="T35:U294"><span class="mxinfo " id="T35:U295"><span class="var type1" id="S4T45U495">fulEngOptTn3_old</span>(<span class="mxinfo " id="T49:U297">:</span>,<span class="mxinfo " id="T49:U298">:</span>,<span class="var type1" id="S37T2U498">wayInx</span>)</span> = <span class="var type1" id="S41T35U499">fulEngActMat_old</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,378" id="srcline378">378</a></span><span class="line">    <span class="comment">% optimale Batterieenergie zum aktuellen Punkt</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,379" id="srcline379">379</a></span><span class="line">    <span class="comment">% optimal battery force at current point - save current mat in tensor</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,380" id="srcline380">380</a></span><span class="line">    <span class="comment">% FlussgrÃ¶ÃŸe gilt im Intervall</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,381" id="srcline381">381</a></span><span class="line">    <span class="comment">% flux quantity applied over the interval</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,382" id="srcline382">382</a></span><span class="line">    <span class="mxinfo " id="T35:U301"><span class="mxinfo " id="T35:U302"><span class="var type1" id="S3T45U503">batFrcOptTn3_old</span>(<span class="mxinfo " id="T49:U304">:</span>,<span class="mxinfo " id="T49:U305">:</span>,<span class="mxinfo " id="T2:U306"><span class="var type1" id="S37T2U507">wayInx</span>-<span class="mxinfo " id="T2:U308">1</span></span>)</span> = <span class="var type1" id="S39T35U509">batFrcOptMat_old</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="29,383" id="srcline383">383</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="29,384" id="srcline384">384</a></span><span class="line">    <span class="comment">% Ausgabe des aktuellen Schleifendurchlaufs</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,385" id="srcline385">385</a></span><span class="line">    <span class="comment">% output for current loop - print to terminal</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,386" id="srcline386">386</a></span><span class="line">    <span class="keyword">if</span> <span class="var type1" id="S6T2U512">disFlg</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,387" id="srcline387">387</a></span><span class="line">        fprintf(<span class="string">'Schleife %1.0f berechnet. %1.0f %% geschafft. \r'</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,388" id="srcline388">388</a></span><span class="line">            double(<span class="mxinfo " id="T2:U311"><span class="var type1" id="S37T2U520">wayInx</span>-<span class="var type1" id="S14T2U521">wayInxBeg</span></span>), <span class="mxinfo " id="T2:U314"><span class="mxinfo " id="T2:U315">double(((<span class="mxinfo " id="T2:U316"><span class="var type1" id="S37T2U529">wayInx</span>-<span class="var type1" id="S14T2U530">wayInxBeg</span></span>)))/<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="29,389" id="srcline389">389</a></span><span class="line"><span class="mxinfo " id="T2:U314"><span class="mxinfo " id="T2:U315">            double(<span class="mxinfo " id="T2:U319"><span class="var type1" id="S15T2U534">wayInxEnd</span>-<span class="var type1" id="S14T2U535">wayInxBeg</span></span>)</span>*<span class="mxinfo " id="T2:U322">100</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="29,390" id="srcline390">390</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,391" id="srcline391">391</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,392" id="srcline392">392</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% end of looping through all discretized path indexes</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,393" id="srcline393">393</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="29,394" id="srcline394">394</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% END OF FUNCTION</span></span></span>
<span class="srcline"><span class="lineno"><a href="29,395" id="srcline395">395</a></span><span class="line"></span></span>
</pre>
