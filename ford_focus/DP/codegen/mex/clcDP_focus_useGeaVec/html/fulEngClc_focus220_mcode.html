<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="72,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [                  <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,2" id="srcline2"> 2</a></span><span class="line">    <span class="var type1" id="S2T3U3">fulEng</span>                  <span class="keyword">...</span><span class="comment"> Skalar Kraftstoffkraft</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,3" id="srcline3"> 3</a></span><span class="line">] =                         <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,4" id="srcline4"> 4</a></span><span class="line">    fulEngClc_focus         <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,5" id="srcline5"> 5</a></span><span class="line">(                           <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,6" id="srcline6"> 6</a></span><span class="line">    <span class="var type1" id="S3T3U6">timeStp</span>,                <span class="keyword">...</span><span class="comment"> Skalar f체r die Wegschrittweite in m</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,7" id="srcline7"> 7</a></span><span class="line">    <span class="var type1" id="S4T3U7">vel</span>,                    <span class="keyword">...</span><span class="comment"> vehicular velocity</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,8" id="srcline8"> 8</a></span><span class="line">    <span class="var type1" id="S5T3U8">crsSpdPre</span>,              <span class="keyword">...</span><span class="comment"> Skalar - crankshaft speed at given path_idx</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,9" id="srcline9"> 9</a></span><span class="line">    <span class="var type1" id="S6T3U9">iceTrq</span>,                 <span class="keyword">...</span><span class="comment"> Skalar - ice torque at given path_idx</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,10" id="srcline10">10</a></span><span class="line">    <span class="var type1" id="S7T3U10">iceTrqMax</span>,              <span class="keyword">...</span><span class="comment"> Skalar - max ICE torque</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,11" id="srcline11">11</a></span><span class="line">    <span class="var type1" id="S8T44U11">fzg_scalar_struct</span>,      <span class="keyword">...</span><span class="comment"> struct - Fahrzeugparameter - nur skalar</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,12" id="srcline12">12</a></span><span class="line">    <span class="var type1" id="S9T10U12">iceSpdMgd</span>,              <span class="keyword">...</span><span class="comment"> input ICE speed value</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,13" id="srcline13">13</a></span><span class="line">    <span class="var type1" id="S10T11U13">iceTrqMgd</span>,              <span class="keyword">...</span><span class="comment"> input ICE torque value</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,14" id="srcline14">14</a></span><span class="line">    <span class="var type1" id="S11T12U14">iceFulPwr_iceSpd_iceTrq</span> <span class="keyword">...</span><span class="comment"> lookup ICE power table</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,15" id="srcline15">15</a></span><span class="line">) <span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,16" id="srcline16">16</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,17" id="srcline17">17</a></span><span class="line"><span class="comment">%FULENGCLC Calculating fuel consumption</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,18" id="srcline18">18</a></span><span class="line"><span class="comment">% Erstellungsdatum der ersten Version 04.09.2015 - Stephan Uebel</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,19" id="srcline19">19</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,20" id="srcline20">20</a></span><span class="line"><span class="comment">% Diese Funktion berechnet den Kraftstoffverbrauch f체r einen gegebenen</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,21" id="srcline21">21</a></span><span class="line"><span class="comment">% Wegschritt der kinetischen Energie, der Batterieenergie und des</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,22" id="srcline22">22</a></span><span class="line"><span class="comment">% Antriebsstrangzustands 체ber dem Weg.</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,23" id="srcline23">23</a></span><span class="line"><span class="comment">%   this function calculates fuel consumption for a given route step of</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,24" id="srcline24">24</a></span><span class="line"><span class="comment">%   KE, the battery energy, and drivetrain state of the current path_idx</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,25" id="srcline25">25</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,26" id="srcline26">26</a></span><span class="line"><span class="comment">% Version vom 17.02.2016 : Rotationsmassen vernachl채ssigt</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,27" id="srcline27">27</a></span><span class="line"><span class="comment">%                           ^^ neglected rotatary masses</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,28" id="srcline28">28</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,29" id="srcline29">29</a></span><span class="line"><span class="comment">% Version vom 25.05.2016: Zero-Order-Hold (keine mittlere Geschwindigkeit)</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,30" id="srcline30">30</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,31" id="srcline31">31</a></span><span class="line"><span class="comment">% version from 1.06.2016 - removed crsTrq calculations - they are already</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,32" id="srcline32">32</a></span><span class="line"><span class="comment">% done in parent function (clcPMP_olHyb_tmp) and do not change w/ each</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,33" id="srcline33">33</a></span><span class="line"><span class="comment">% iteration, making the calculation here unnecessary</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,34" id="srcline34">34</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,35" id="srcline35">35</a></span><span class="line"><span class="comment">% % 06.07.2016 - replacing KE state dimension with engine control</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,36" id="srcline36">36</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,37" id="srcline37">37</a></span><span class="line"><span class="comment">% am using values from previous timeIdx (velocity, engine state), but I am</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,38" id="srcline38">38</a></span><span class="line"><span class="comment">% not 100% sure why - will have to look into later.</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,39" id="srcline39">39</a></span><span class="line"><span class="comment">% But older code used predecesor values as well</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,40" id="srcline40">40</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,41" id="srcline41">41</a></span><span class="line"><span class="comment">% 15.05.2016 - refitting so that fuel calculations are for straight E'</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,42" id="srcline42">42</a></span><span class="line"><span class="comment">% states - checks have been moved further up in loops outside this function</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,43" id="srcline43">43</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="72,44" id="srcline44">44</a></span><span class="line"><span class="comment">%% Initialisieren der Ausgabe der Funktion</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,45" id="srcline45">45</a></span><span class="line"><span class="comment">%   initializing function output</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,46" id="srcline46">46</a></span><span class="line"><span class="mxinfo " id="T3:U11"><span class="var type1" id="S2T3U17">fulEng</span>    = <span class="mxinfo " id="T3:U13">inf</span></span>;    <span class="comment">%   Skalar - fuel force intialization (N)</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,47" id="srcline47">47</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="72,48" id="srcline48">48</a></span><span class="line"><span class="comment">%% Fuel energy calculation</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,49" id="srcline49">49</a></span><span class="line"><span class="comment">% Wenn das Verbrennungsmotormoment kleiner als das minimale</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,50" id="srcline50">50</a></span><span class="line"><span class="comment">% Moment ist, ist dieser in der Schubabschaltung. Das</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,51" id="srcline51">51</a></span><span class="line"><span class="comment">% verbleibende Moment liefern die Bremsen</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,52" id="srcline52">52</a></span><span class="line"><span class="comment">%   If engine torque is less than the min torque, fuel is cut (or if</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,53" id="srcline53">53</a></span><span class="line"><span class="comment">%   vehicle is stationary). The remaining torque is delivered to brakes.</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,54" id="srcline54">54</a></span><span class="line"><span class="comment">%   - also calculate fuel force (Berechnen der Kraftstoffkraft)</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,55" id="srcline55">55</a></span><span class="line"><span class="comment">%       18.07.2016 - modified the less than min torque piece and moved it</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,56" id="srcline56">56</a></span><span class="line"><span class="comment">%       to parent function optTrqSplot_focus as part of boundary tests.</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,57" id="srcline57">57</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T1:U14"><span class="var type1" id="S4T3U23">vel</span> &lt; <span class="mxinfo " id="T3:U16">abs(<span class="mxinfo " id="T3:U17"><span class="var type1" id="S8T44U27">fzg_scalar_struct</span>.vehVelThresh</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="72,58" id="srcline58">58</a></span><span class="line">    <span class="mxinfo " id="T3:U19"><span class="var type1" id="S2T3U31">fulEng</span> = <span class="mxinfo " id="T3:U21">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="72,59" id="srcline59">59</a></span><span class="line"><span class="keyword">elseif</span> <span class="mxinfo " id="T1:U22"><span class="var type1" id="S6T3U35">iceTrq</span> &gt; <span class="var type1" id="S7T3U36">iceTrqMax</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="72,60" id="srcline60">60</a></span><span class="line">    <span class="mxinfo " id="T3:U25"><span class="var type1" id="S2T3U39">fulEng</span> = <span class="mxinfo " id="T3:U27">inf</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="72,61" id="srcline61">61</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,62" id="srcline62">62</a></span><span class="line">    <span class="comment">% calculate fuel power</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,63" id="srcline63">63</a></span><span class="line">    <span class="mxinfo " id="T3:U28"><span class="var type1" id="S14T3U45">fulPwr</span> = <span class="mxinfo " id="T3:U30"><span class="fcn" id="F219N3:B47">codegen_interp2</span>(<span class="var type1" id="S9T10U48">iceSpdMgd</span>, <span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="72,64" id="srcline64">64</a></span><span class="line"><span class="mxinfo " id="T3:U28"><span class="mxinfo " id="T3:U30">                     <span class="var type1" id="S10T11U49">iceTrqMgd</span>, <span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="72,65" id="srcline65">65</a></span><span class="line"><span class="mxinfo " id="T3:U28"><span class="mxinfo " id="T3:U30">                     <span class="var type1" id="S11T12U50">iceFulPwr_iceSpd_iceTrq</span>, <span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="72,66" id="srcline66">66</a></span><span class="line"><span class="mxinfo " id="T3:U28"><span class="mxinfo " id="T3:U30">                     <span class="var type1" id="S5T3U51">crsSpdPre</span>, <span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="72,67" id="srcline67">67</a></span><span class="line"><span class="mxinfo " id="T3:U28"><span class="mxinfo " id="T3:U30">                     <span class="var type1" id="S6T3U52">iceTrq</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="72,68" id="srcline68">68</a></span><span class="line">    <span class="comment">% since P = E/t, then E=P*t</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,69" id="srcline69">69</a></span><span class="line">    <span class="mxinfo " id="T3:U36"><span class="var type1" id="S2T3U55">fulEng</span> = <span class="mxinfo " id="T3:U38"><span class="var type1" id="S14T3U57">fulPwr</span> * <span class="var type1" id="S3T3U58">timeStp</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="72,70" id="srcline70">70</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,71" id="srcline71">71</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="72,72" id="srcline72">72</a></span><span class="line"><span class="comment">%% Ende der Funktion</span></span></span>
<span class="srcline"><span class="lineno"><a href="72,73" id="srcline73">73</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
